<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Ceph 各版本特性对比与演进分析 - Friends&#39; Life and Work Space</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="ceph-deep-dive" /><meta name="description" content="Ceph 各版本特性对比与演进分析 本文档详细分析了Ceph从Nautilus (v14)到最新Squid (v19)版本的主要特性演进，为选择合适版本和" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.100.2 with theme even" />


<link rel="canonical" href="http://YLShiJustFly.github.io/post/ceph-content/application-practice/zh-cn/ceph-%E5%90%84%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7%E5%AF%B9%E6%AF%94%E4%B8%8E%E6%BC%94%E8%BF%9B%E5%88%86%E6%9E%90/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Ceph 各版本特性对比与演进分析" />
<meta property="og:description" content="Ceph 各版本特性对比与演进分析 本文档详细分析了Ceph从Nautilus (v14)到最新Squid (v19)版本的主要特性演进，为选择合适版本和" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://YLShiJustFly.github.io/post/ceph-content/application-practice/zh-cn/ceph-%E5%90%84%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7%E5%AF%B9%E6%AF%94%E4%B8%8E%E6%BC%94%E8%BF%9B%E5%88%86%E6%9E%90/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2025-06-10T15:17:59+08:00" />
<meta property="article:modified_time" content="2025-06-10T15:17:59+08:00" />

<meta itemprop="name" content="Ceph 各版本特性对比与演进分析">
<meta itemprop="description" content="Ceph 各版本特性对比与演进分析 本文档详细分析了Ceph从Nautilus (v14)到最新Squid (v19)版本的主要特性演进，为选择合适版本和"><meta itemprop="datePublished" content="2025-06-10T15:17:59+08:00" />
<meta itemprop="dateModified" content="2025-06-10T15:17:59+08:00" />
<meta itemprop="wordCount" content="11150">
<meta itemprop="keywords" content="ceph," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ceph 各版本特性对比与演进分析"/>
<meta name="twitter:description" content="Ceph 各版本特性对比与演进分析 本文档详细分析了Ceph从Nautilus (v14)到最新Squid (v19)版本的主要特性演进，为选择合适版本和"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Friends&#39; Life and Work Space</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Friends&#39; Life and Work Space</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Ceph 各版本特性对比与演进分析</h1>

      <div class="post-meta">
        <span class="post-time"> 2025-06-10 </span>
        <div class="post-category">
            <a href="/categories/ceph/"> ceph </a>
            </div>
          <span class="more-meta"> 11150 words </span>
          <span class="more-meta"> 23 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ceph-各版本特性对比与演进分析">Ceph 各版本特性对比与演进分析</a>
      <ul>
        <li><a href="#版本概览">版本概览</a></li>
        <li><a href="#版本特性对比总结">版本特性对比总结</a>
          <ul>
            <li><a href="#成熟度驱动的版本选择指南">成熟度驱动的版本选择指南</a></li>
            <li><a href="#特性驱动的版本选择指南">特性驱动的版本选择指南</a></li>
          </ul>
        </li>
        <li><a href="#特性首次引入与成熟度分析">特性首次引入与成熟度分析</a>
          <ul>
            <li><a href="#重要特性生命周期时间线">重要特性生命周期时间线</a></li>
          </ul>
        </li>
        <li><a href="#nautilus-n版本">Nautilus (N版本)</a>
          <ul>
            <li><a href="#版本发布情况">版本发布情况</a></li>
            <li><a href="#主要亮点">主要亮点</a></li>
            <li><a href="#重要更新和修复">重要更新和修复</a></li>
          </ul>
        </li>
        <li><a href="#octopus">Octopus</a>
          <ul>
            <li><a href="#版本发布情况-1">版本发布情况</a></li>
            <li><a href="#核心主题">核心主题</a></li>
            <li><a href="#主要亮点-1">主要亮点</a></li>
            <li><a href="#重要修复和安全更新">重要修复和安全更新</a></li>
          </ul>
        </li>
        <li><a href="#pacific">Pacific</a>
          <ul>
            <li><a href="#版本发布情况-2">版本发布情况</a></li>
            <li><a href="#主要亮点-2">主要亮点</a></li>
            <li><a href="#重要变更">重要变更</a></li>
            <li><a href="#重要注意事项">重要注意事项</a></li>
          </ul>
        </li>
        <li><a href="#quincy">Quincy</a>
          <ul>
            <li><a href="#版本发布情况-3">版本发布情况</a></li>
            <li><a href="#主要亮点-3">主要亮点</a></li>
          </ul>
        </li>
        <li><a href="#reef">Reef</a>
          <ul>
            <li><a href="#版本发布情况-4">版本发布情况</a></li>
            <li><a href="#主要亮点-4">主要亮点</a></li>
          </ul>
        </li>
        <li><a href="#squid">Squid</a>
          <ul>
            <li><a href="#版本发布情况-5">版本发布情况</a></li>
            <li><a href="#主要亮点-5">主要亮点</a></li>
            <li><a href="#重要修复">重要修复</a></li>
          </ul>
        </li>
        <li><a href="#参考资料">参考资料</a>
          <ul>
            <li><a href="#官方文档">官方文档</a></li>
            <li><a href="#技术文章">技术文章</a></li>
            <li><a href="#技术讲座">技术讲座</a></li>
          </ul>
        </li>
        <li><a href="#特别说明">特别说明</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h1 id="ceph-各版本特性对比与演进分析">Ceph 各版本特性对比与演进分析</h1>
<p>本文档详细分析了Ceph从Nautilus (v14)到最新Squid (v19)版本的主要特性演进，为选择合适版本和制定升级策略提供参考。(在LLM的帮助下整理)</p>
<h2 id="版本概览">版本概览</h2>
<table>
<thead>
<tr>
<th>版本</th>
<th>代号</th>
<th>发布时间</th>
<th>生命周期状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>v14.2.x</td>
<td>Nautilus</td>
<td>2019年</td>
<td>EOL</td>
</tr>
<tr>
<td>v15.2.x</td>
<td>Octopus</td>
<td>2020年</td>
<td>EOL</td>
</tr>
<tr>
<td>v16.2.x</td>
<td>Pacific</td>
<td>2021年</td>
<td>EOL</td>
</tr>
<tr>
<td>v17.2.x</td>
<td>Quincy</td>
<td>2022年</td>
<td>EOL</td>
</tr>
<tr>
<td>v18.2.x</td>
<td>Reef</td>
<td>2023年</td>
<td>稳定维护版</td>
</tr>
<tr>
<td>v19.2.x</td>
<td>Squid</td>
<td>2024年</td>
<td>当前稳定版</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="版本特性对比总结">版本特性对比总结</h2>
<h3 id="成熟度驱动的版本选择指南">成熟度驱动的版本选择指南</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>Nautilus</th>
<th>Octopus</th>
<th>Pacific</th>
<th>Quincy</th>
<th>Reef</th>
<th>Squid</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>部署方式</strong></td>
<td>ceph-deploy</td>
<td><strong>cephadm引入</strong></td>
<td>cephadm</td>
<td>cephadm成熟</td>
<td>cephadm</td>
<td>cephadm</td>
</tr>
<tr>
<td><strong>存储引擎</strong></td>
<td>BlueStore</td>
<td>BlueStore</td>
<td>BlueStore</td>
<td>BlueStore</td>
<td><strong>FileStore移除</strong></td>
<td>BlueStore优化</td>
</tr>
<tr>
<td><strong>配置管理</strong></td>
<td><strong>集中化引入</strong></td>
<td>集中化</td>
<td>集中化</td>
<td>集中化</td>
<td>集中化</td>
<td>集中化</td>
</tr>
<tr>
<td><strong>网络协议</strong></td>
<td><strong>msgr2引入</strong></td>
<td>msgr2稳定</td>
<td>msgr2</td>
<td>msgr2</td>
<td>msgr2</td>
<td>msgr2</td>
</tr>
<tr>
<td><strong>PG管理</strong></td>
<td><strong>autoscale引入</strong></td>
<td>autoscale</td>
<td>autoscale</td>
<td>autoscale</td>
<td>autoscale</td>
<td>autoscale</td>
</tr>
<tr>
<td><strong>调度器</strong></td>
<td>传统</td>
<td>改进</td>
<td><strong>mclock引入</strong></td>
<td><strong>mclock默认</strong></td>
<td>mclock</td>
<td>mclock优化</td>
</tr>
<tr>
<td><strong>CephFS多FS</strong></td>
<td><strong>首次支持</strong></td>
<td>功能增强</td>
<td><strong>镜像完善</strong></td>
<td>管理优化</td>
<td>管理优化</td>
<td>Dashboard集成</td>
</tr>
<tr>
<td><strong>多站点</strong></td>
<td>基础</td>
<td><strong>RBD镜像</strong></td>
<td><strong>CephFS镜像</strong></td>
<td>完善</td>
<td>增强</td>
<td>增强</td>
</tr>
<tr>
<td><strong>Dashboard</strong></td>
<td>基础</td>
<td>改进</td>
<td>改进</td>
<td>改进</td>
<td><strong>重构</strong></td>
<td><strong>重构</strong></td>
</tr>
<tr>
<td><strong>容器化</strong></td>
<td>无</td>
<td><strong>cephadm预览</strong></td>
<td><strong>cephadm成熟</strong></td>
<td>cephadm完整</td>
<td>cephadm</td>
<td>cephadm</td>
</tr>
</tbody>
</table>
<h4 id="特性成熟度标记说明">特性成熟度标记说明</h4>
<ul>
<li><strong>加粗文字</strong>: 该版本中特性的重要节点（首次引入/达到稳定/重大改进）</li>
<li>普通文字: 特性在该版本中保持稳定或有小幅改进</li>
<li>斜体文字: 特性在该版本中被弃用或准备移除</li>
</ul>
<h3 id="特性驱动的版本选择指南">特性驱动的版本选择指南</h3>
<table>
<thead>
<tr>
<th>所需特性</th>
<th>最低版本</th>
<th>稳定推荐版本</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>中心化配置管理</td>
<td>Nautilus</td>
<td>Octopus+</td>
<td>基础功能可用，建议升级获得稳定性</td>
</tr>
<tr>
<td>PG autoscaling</td>
<td>Nautilus</td>
<td>Pacific+</td>
<td>生产环境建议手动控制</td>
</tr>
<tr>
<td>msgr2安全协议</td>
<td>Nautilus</td>
<td>Octopus+</td>
<td>新部署建议直接使用</td>
</tr>
<tr>
<td>cephadm容器化管理</td>
<td>Octopus</td>
<td>Pacific+</td>
<td>技术预览→生产可用</td>
</tr>
<tr>
<td>CephFS多文件系统</td>
<td>Nautilus</td>
<td>Pacific+</td>
<td>基础支持→生产可用</td>
</tr>
<tr>
<td>CephFS镜像/灾备</td>
<td>Octopus</td>
<td>Pacific+</td>
<td>功能引入→生产稳定</td>
</tr>
<tr>
<td>mclock QoS调度</td>
<td>Pacific</td>
<td>Quincy+</td>
<td>引入→默认启用</td>
</tr>
<tr>
<td>完全容器化部署</td>
<td>Pacific</td>
<td>Quincy+</td>
<td>基础支持→完整生态</td>
</tr>
<tr>
<td>高级Dashboard</td>
<td>Reef</td>
<td>Squid+</td>
<td>重构→完善</td>
</tr>
<tr>
<td>FileStore替换</td>
<td>任意版本</td>
<td>Reef+</td>
<td>Reef后FileStore不再支持</td>
</tr>
</tbody>
</table>
<h2 id="特性首次引入与成熟度分析">特性首次引入与成熟度分析</h2>
<h3 id="重要特性生命周期时间线">重要特性生命周期时间线</h3>
<p>本节详细说明关键特性的首次引入版本、稳定版本以及推荐的生产环境采用时机，帮助用户做出明智的版本选择。</p>
<h4 id="配置管理演进">配置管理演进</h4>
<ul>
<li><strong>中心化配置管理</strong>
<ul>
<li><strong>首次引入</strong>: Nautilus (v14.x) - 基础功能可用</li>
<li><strong>稳定推荐</strong>: Octopus (v15.x) - 修复了关键bug，生产环境可用</li>
<li><strong>技术价值</strong>: 统一管理配置，支持在线修改，提供审计功能</li>
</ul>
</li>
</ul>
<h4 id="存储池管理革新">存储池管理革新</h4>
<ul>
<li><strong>PG autoscaling/merging</strong>
<ul>
<li><strong>首次引入</strong>: Nautilus (v14.x) - 历史性突破，支持PG数量减少</li>
<li><strong>稳定推荐</strong>: Pacific (v16.x) - 算法优化，减少误操作风险</li>
<li><strong>⚠️ 生产建议</strong>: 建议手动控制，避免自动调优造成的I/O影响</li>
</ul>
</li>
</ul>
<h4 id="网络协议升级">网络协议升级</h4>
<ul>
<li><strong>msgr2协议</strong>
<ul>
<li><strong>首次引入</strong>: Nautilus (v14.x) - 安全性和性能大幅提升</li>
<li><strong>稳定推荐</strong>: Octopus (v15.x) - 修复兼容性问题，可大规模部署</li>
<li><strong>技术价值</strong>: 端到端加密，更强身份验证，更低延迟</li>
</ul>
</li>
</ul>
<h4 id="编排管理变革">编排管理变革</h4>
<ul>
<li><strong>cephadm容器化编排</strong>
<ul>
<li><strong>首次引入</strong>: Octopus (v15.x) - 技术预览版</li>
<li><strong>稳定推荐</strong>: Pacific (v16.x) - 生产可用，功能完善</li>
<li><strong>完全成熟</strong>: Quincy (v17.x) - 替代ceph-deploy，成为主流方案</li>
<li><strong>革命意义</strong>: 从包管理转向容器化，大幅简化运维</li>
</ul>
</li>
</ul>
<h4 id="分布式文件系统演进">分布式文件系统演进</h4>
<ul>
<li><strong>CephFS多文件系统</strong>
<ul>
<li><strong>首次引入</strong>: Nautilus (v14.x) - 基础多FS支持</li>
<li><strong>功能完善</strong>: Octopus (v15.x) - 快照和镜像功能</li>
<li><strong>生产推荐</strong>: Pacific (v16.x) - 镜像功能稳定，可用于生产环境</li>
<li><strong>管理优化</strong>: Squid (v19.x) - Dashboard集成，子卷管理完善</li>
</ul>
</li>
</ul>
<h4 id="存储引擎发展">存储引擎发展</h4>
<ul>
<li><strong>BlueStore成熟化</strong>
<ul>
<li><strong>默认引擎</strong>: Mimic (v13.x) - BlueStore替代FileStore成为默认存储引擎</li>
<li><strong>性能优化</strong>: Nautilus (v14.x) - bitmap allocator，大幅性能提升</li>
<li><strong>完全成熟</strong>: Pacific (v16.x) - 性能和稳定性达到最佳</li>
<li><strong>FileStore淘汰</strong>: Reef (v18.x) - FileStore完全移除支持</li>
</ul>
</li>
<li><strong>Crimson/Seastore (下一代)</strong>
<ul>
<li><strong>技术预览</strong>: Quincy (v17.x) - 实验性功能</li>
<li><strong>功能增强</strong>: Squid (v19.x) - 支持RBD工作负载</li>
<li><strong>预期成熟</strong>: 未来版本 - 生产环境可用</li>
</ul>
</li>
</ul>
<h2 id="nautilus-n版本">Nautilus (N版本)</h2>
<h3 id="版本发布情况">版本发布情况</h3>
<ul>
<li><strong>当前版本</strong>: v14.2.22</li>
<li><strong>版本系列</strong>: v14.2.0 到 v14.2.22</li>
<li><strong>生命周期</strong>: v14.2.22是Nautilus系列的最后一个版本，EOL</li>
</ul>
<h3 id="主要亮点">主要亮点</h3>
<h4 id="中心化配置管理">中心化配置管理</h4>
<ul>
<li><strong>特性</strong>: 相比于之前所有持久化配置都需要写在ceph.conf中的方式，现有的方式更加方便管理，包括查看、修改、审计</li>
<li><strong>核心价值</strong>: 统一管理所有集群配置，支持在线修改，提供配置历史和审计功能，大大简化了大规模集群的配置管理</li>
</ul>
<h5 id="配置管理命令">配置管理命令</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看现有的config设置</span>
</span></span><span class="line"><span class="cl">ceph config dump
</span></span><span class="line"><span class="cl"><span class="c1"># get/set 某一级或是某个实例的配置，支持多级相同配置进行override，使用粒度最小的</span>
</span></span><span class="line"><span class="cl">ceph config get <span class="nv">$level</span> <span class="nv">$entityname</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> <span class="nv">$level</span> <span class="nv">$entityname</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 举例</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> global osd_recovery_sleep_hdd 0.1
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> osd osd_recovery_sleep_hdd 0.1
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> <span class="s1">&#39;osd.*&#39;</span> osd_recovery_sleep_hdd  <span class="c1"># 获取服务级别的稍微不一样，需要加*</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> osd.1 osd_recovery_sleep_hdd 0.2
</span></span><span class="line"><span class="cl"><span class="c1"># 查看某个entity的help信息</span>
</span></span><span class="line"><span class="cl">sudo ceph config <span class="nb">help</span> osd_recovery_sleep_hdd
</span></span><span class="line"><span class="cl"><span class="c1"># 修改历史log，做审计</span>
</span></span><span class="line"><span class="cl">sudo ceph config log
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="配置管理要点">配置管理要点</h5>
<ul>
<li>有一些之前需要重启生效的参数现在可以在线调节了，可以靠help来确认，比如说osd_target_memory</li>
<li>osd_class_update_on_start需要在osd创建的时候设置为true，会自动加入到tree中，完成后false，防止osd重启导致crush tree变化</li>
</ul>
<h4 id="pg-merging和autotuning">PG merging和autotuning</h4>
<ul>
<li><strong>⭐ 重大突破</strong>: 这是Ceph历史上的重大突破，Nautilus首次支持PG数量减少(merging)和自动调优功能</li>
<li><strong>PG数量减少</strong>: pg数量允许减少，也就是说可以做merge了，解决了之前PG数量只能增加不能减少的限制</li>
<li><strong>PG默认autoscale</strong>: pg默认会开启autoscale，自动根据数据量调整PG数量</li>
<li><strong>技术意义</strong>: 让存储池管理更加智能化和灵活，减少手动调优工作量</li>
<li><strong>⚠️ 生产环境注意</strong>: 调整会导致peering过程，造成I/O卡顿和大量数据迁移。生产环境建议设置 <code>osd_pool_default_pg_autoscale_mode=off</code>，手动控制PG调整时机</li>
</ul>
<h4 id="设备管理和故障预测">设备管理和故障预测</h4>
<ul>
<li><strong>设备管理</strong>: 新的设备管理功能</li>
<li><strong>故障预测</strong>: 基于设备健康指标的故障预测模型</li>
</ul>
<h4 id="崩溃信息收集">崩溃信息收集</h4>
<ul>
<li><strong>服务</strong>: 每个节点上都运行了一个ceph-crash服务</li>
<li><strong>功能</strong>: 如果有进程崩溃（比如assert），会收集环境信息和backtrace，并上报</li>
</ul>
<h4 id="消息传递msgr2和安全性配置">消息传递(msgr2)和安全性配置</h4>
<ul>
<li><strong>⭐ 协议革新</strong>: Nautilus首次引入msgr2协议，这是Ceph网络通信的重大升级</li>
<li><strong>msgr2协议</strong>: 新的消息传递协议v2，提供更好的安全性和性能
<ul>
<li><strong>加密传输</strong>: 支持端到端加密，保护集群内部通信安全</li>
<li><strong>身份验证</strong>: 提供更强的身份验证机制，防止中间人攻击</li>
<li><strong>性能提升</strong>: 优化的网络协议栈，降低延迟和CPU开销</li>
</ul>
</li>
<li><strong>向后兼容</strong>: 为保证与旧客户端兼容，需要配置同时支持msgr1和msgr2</li>
<li><strong>主要配置</strong>: global_id和不启用msgr2（如需兼容旧环境）</li>
<li><strong>迁移建议</strong>: 新部署建议直接使用msgr2，旧集群可逐步迁移</li>
</ul>
<h4 id="rados相关改进">RADOS相关改进</h4>
<ul>
<li><strong>bluestore</strong>: 新的 &lsquo;bitmap&rsquo; allocator（比avl allocator性能更好，减少碎片）</li>
<li><strong>异步恢复</strong>: 改良的async recovery（减少恢复对客户端I/O的影响）</li>
<li><strong>scrub</strong>: scrub支持autorepair（自动修复检测到的数据不一致问题）</li>
<li><strong>纠删码</strong>: 添加了新的纠删码算法（提供更好的存储效率和容错能力）</li>
<li><strong>pool配额</strong>: pool支持设置quota（限制存储池的空间和对象数量使用）</li>
<li><strong>负载均衡</strong>: ceph balancer（自动优化数据分布，提高集群性能均衡性）</li>
</ul>
<h4 id="rbd相关改进">RBD相关改进</h4>
<ul>
<li><strong>命名空间</strong>: 支持namespace（命名空间），实现多租户资源隔离，不同租户可以使用相同的镜像名称而不冲突</li>
<li><strong>时间戳</strong>: 卷支持了Creation, access, modification timestamps，便于审计和管理</li>
<li><strong>监控增强</strong>: mgr的Prometheus插件现在可以监控单个卷的详细I/O统计信息，提供更精细的性能分析能力</li>
</ul>
<h4 id="cephfs相关改进">CephFS相关改进</h4>
<ul>
<li><strong>多文件系统</strong>: 支持在单个集群中创建和管理多个独立的文件系统，每个文件系统有独立的元数据池
<ul>
<li><strong>⭐ 首次引入</strong>: Nautilus版本首次引入多文件系统支持，为后续版本的完善奠定基础</li>
<li><strong>稳定建议</strong>: 虽然功能可用，但建议在生产环境中先进行充分测试</li>
</ul>
</li>
<li><strong>管理接口</strong>: 引入卷管理概念，将复杂的文件系统操作抽象为简单的卷管理，模拟块存储的管理方式
<ul>
<li><strong>概念映射</strong>: fs(文件系统) → volume(卷)，directory(目录) → subvolume(子卷)</li>
</ul>
</li>
<li><strong>稳定性提升</strong>:
<ul>
<li><strong>Client caps限制</strong>: 限制了客户端获取caps的速度，防止MDS因过多caps请求而内存溢出(OOM)</li>
<li><strong>Caps</strong>: 是CephFS的能力授权机制，控制客户端对文件/目录的访问权限</li>
</ul>
</li>
<li><strong>启动优化</strong>:
<ul>
<li><strong>OpenTable文件</strong>: 记录已打开文件的信息，如果MDS重启过慢，可以删除此文件加速启动</li>
<li><strong>适用场景</strong>: 在紧急恢复或大量文件打开的环境中特别有用</li>
</ul>
</li>
<li><strong>配额功能</strong>: 内核客户端现在支持配额限制，可以对目录或子卷设置空间和文件数量限制</li>
</ul>
<h5 id="subvolume">Subvolume</h5>
<ul>
<li><strong>子卷管理</strong>: 支持在文件系统内创建隔离的子卷，每个子卷有独立的配额和访问控制</li>
<li><strong>CSI集成</strong>: 如果要使用Kubernetes CSI驱动，需要创建专用的CSI子卷组来管理动态卷供应</li>
</ul>
<h5 id="lazyio">LAZYIO</h5>
<ul>
<li><strong>延迟IO模式</strong>: 新的IO模式，允许应用程序延迟写入操作，提高小文件写入性能</li>
<li><strong>缓存机制</strong>: 客户端可以缓存写入数据，减少网络往返次数</li>
<li><strong>适用场景</strong>: 特别适合频繁小文件写入的工作负载</li>
</ul>
<h4 id="ceph-mgr">ceph-mgr</h4>
<ul>
<li><strong>Prometheus插件</strong>:
<ul>
<li><strong>标准监控</strong>: mgr的prometheus插件提供标准的监控指标接口，需要手动启用</li>
<li><strong>集成优势</strong>: 与Grafana等监控系统无缝集成，提供丰富的性能仪表板</li>
</ul>
</li>
<li><strong>稳定性问题</strong>:
<ul>
<li><strong>CephFS场景</strong>: 在CephFS环境下，mgr可能出现死锁问题，需要定期重启mgr服务</li>
<li><strong>监控建议</strong>: 建议监控mgr服务状态，出现异常及时重启</li>
</ul>
</li>
<li><strong>模块管理</strong>:
<ul>
<li><strong>Restful模块Bug</strong>: restful模块存在内存泄露问题，建议关闭该模块避免mgr OOM</li>
<li><strong>禁用命令</strong>: <code>ceph mgr module disable restful</code></li>
</ul>
</li>
</ul>
<h3 id="重要更新和修复">重要更新和修复</h3>
<h4 id="性能优化">性能优化</h4>
<ul>
<li><strong>BlueStore缓存</strong>: <code>bluefs_buffered_io</code>默认设置为true，提高元数据密集型工作负载的性能</li>
<li><strong>内存管理</strong>: <code>bluestore_cache_trim_max_skip_pinned</code>默认值增加到1000，控制onodes导致的内存增长</li>
<li><strong>监控器修剪</strong>: 引入动态修剪逻辑，通过<code>paxos_service_trim_max_multiplier</code>参数控制</li>
</ul>
<h4 id="稳定性改进">稳定性改进</h4>
<ul>
<li><strong>BlueStore修复</strong>: 修复了Avl/Hybrid分配器中的意外ENOSPC bug</li>
<li><strong>客户端互操作性</strong>: 修复了阻止32位和64位客户端在msgr v2下互操作的长期bug</li>
<li><strong>OSD停机</strong>: 新增<code>--max &lt;n&gt;</code>选项用于<code>osd ok-to-stop</code>命令，提供可以同时停止的OSD数量</li>
</ul>
<h4 id="新功能">新功能</h4>
<ul>
<li><strong>⭐ OSD关机通知</strong>: 首次引入<code>osd_fast_shutdown_notify_mon</code>选项，允许OSD在快速关机时通知监控器
<ul>
<li><strong>技术价值</strong>: 改善集群管理，减少不必要的OSD故障告警</li>
<li><strong>后续完善</strong>: 该特性在Pacific版本中得到进一步优化</li>
</ul>
</li>
<li><strong>多架构支持</strong>: 修复了armv7l (armhf)与x86_64或aarch64服务器混合部署的问题</li>
</ul>
<h4 id="部署说明">部署说明</h4>
<ul>
<li><strong>工具</strong>: 目前还是使用ceph-deploy来部署，这是ceph-deploy支持的最后一个版本</li>
<li><strong>要求</strong>: ceph-deploy需要python2.7并且需要修改部分代码以支持debian11</li>
</ul>
<hr>
<h2 id="octopus">Octopus</h2>
<h3 id="版本发布情况-1">版本发布情况</h3>
<ul>
<li><strong>当前版本</strong>: v15.2.17</li>
<li><strong>版本系列</strong>: v15.2.0 到 v15.2.17</li>
<li><strong>生命周期</strong>: v15.2.17是Octopus系列的最后一个版本，已归档</li>
</ul>
<h3 id="核心主题">核心主题</h3>
<p>Ceph Octopus 版本专注于五个不同的主题：多站点使用、质量、性能、可用性和生态系统。</p>
<h3 id="主要亮点-1">主要亮点</h3>
<h4 id="多站点功能">多站点功能</h4>
<ul>
<li><strong>CephFS快照</strong>:
<ul>
<li><strong>快照调度</strong>: 自动定时创建快照，支持按小时、天、周、月等不同周期</li>
<li><strong>快照修剪</strong>: 自动清理过期快照，避免存储空间无限增长</li>
<li><strong>定期快照自动化</strong>: 通过cron表达式灵活配置快照策略</li>
</ul>
</li>
<li><strong>远程同步</strong>:
<ul>
<li><strong>跨集群同步</strong>: 支持将数据同步到远程Ceph集群，实现异地备份</li>
<li><strong>增量同步</strong>: 只同步变更的数据，大大减少网络带宽占用</li>
</ul>
</li>
<li><strong>RBD镜像</strong>:
<ul>
<li><strong>快照镜像模式</strong>: 新增基于快照的镜像模式，提供更可靠的数据一致性</li>
<li><strong>异步复制</strong>: 支持异步复制，减少对主集群性能的影响</li>
</ul>
</li>
<li><strong>应用价值</strong>:
<ul>
<li><strong>自动备份</strong>: 无需人工干预的自动化备份策略</li>
<li><strong>存储优化</strong>: 增量备份大幅节省存储空间</li>
<li><strong>数据保护</strong>: 提供多层次的数据保护和灾难恢复能力</li>
</ul>
</li>
</ul>
<h4 id="质量改进">质量改进</h4>
<ul>
<li><strong>崩溃警报</strong>: Ceph守护进程崩溃时会发出简单的健康警报，并可以触发邮件发送</li>
<li><strong>设备健康</strong>: 新的&quot;设备&quot;遥测通道改进了设备故障预测模型</li>
<li><strong>遥测</strong>: 用户可以选择加入遥测内容扩展</li>
</ul>
<h4 id="性能优化-1">性能优化</h4>
<ul>
<li><strong>恢复优化</strong>: 恢复尾部延迟已得到改善，可以通过仅复制对象的增量在恢复期间进行对象同步</li>
<li><strong>BlueStore改进</strong>:
<ul>
<li>改进了按池计算&quot;omap&quot;（键/值）对象数据</li>
<li>改进了缓存内存管理</li>
<li>减少了SSD设备的分配单元大小</li>
</ul>
</li>
</ul>
<h4 id="可用性提升">可用性提升</h4>
<ul>
<li><strong>⭐ cephadm编排器</strong>:
<ul>
<li><strong>🎯 首次引入</strong>: Octopus版本首次引入cephadm编排器，标志着Ceph运维管理的重大革命性变化</li>
<li><strong>管理革命</strong>: 从传统基于包管理转向现代容器化编排管理，大大降低部署和运维复杂度</li>
<li><strong>容器化部署</strong>: 所有Ceph组件都运行在容器中，提供更好的隔离性和可维护性</li>
<li><strong>自动化管理</strong>: 自动处理服务发现、健康检查、故障恢复等运维任务</li>
<li><strong>成熟度</strong>: 在Octopus中为技术预览版，Pacific版本后达到生产可用成熟度</li>
</ul>
</li>
<li><strong>编排器API</strong>:
<ul>
<li><strong>统一接口</strong>: 提供统一的API接口与cephadm编排器交互</li>
<li><strong>声明式管理</strong>: 支持声明式的服务配置，简化集群管理</li>
</ul>
</li>
<li><strong>SSH管理</strong>:
<ul>
<li><strong>无代理架构</strong>: 通过SSH连接管理各个节点，无需在每个节点安装额外代理</li>
<li><strong>安全连接</strong>: 使用SSH密钥认证，确保管理连接的安全性</li>
<li><strong>命令执行</strong>: 支持在远程节点上执行管理命令，实现集中化管理</li>
</ul>
</li>
<li><strong>仪表板集成</strong>:
<ul>
<li><strong>可视化管理</strong>: Ceph Dashboard与编排器深度集成，提供图形化的集群管理界面</li>
<li><strong>服务管理</strong>: 可以通过Web界面直接管理服务的启停、升级等操作</li>
</ul>
</li>
<li><strong>健康警报</strong>:
<ul>
<li><strong>警报管理</strong>: 支持暂时或永久静音特定的健康警报</li>
<li><strong>降噪功能</strong>: 避免非关键警报干扰，专注于真正重要的问题</li>
</ul>
</li>
<li><strong>历史意义</strong>: cephadm标志着Ceph从传统的基于包管理的部署方式，向现代容器化编排管理的重大转变，大大降低了Ceph集群的部署、升级和日常运维复杂度</li>
</ul>
<h4 id="生态系统增强">生态系统增强</h4>
<ul>
<li><strong>ceph-csi</strong>: 现在通过RBD和CephFS支持RWO和RWX</li>
<li><strong>Rook集成</strong>: 与Rook的集成默认提供交钥匙ceph-csi</li>
<li><strong>功能支持</strong>: 包括RBD镜像、RGW多站点，最终还将包括CephFS镜像</li>
</ul>
<h3 id="重要修复和安全更新">重要修复和安全更新</h3>
<h4 id="安全漏洞修复">安全漏洞修复</h4>
<ul>
<li><strong>CVE-2022-0670</strong>: 修复了OpenStack Manila Native-CephFS的路径限制绕过漏洞</li>
<li><strong>影响范围</strong>: 仅影响使用OpenStack Manila提供native CephFS访问的集群</li>
<li><strong>修复内容</strong>: 修复了Ceph Manager中&quot;volumes&quot;插件的bug，该插件负责管理CephFS子卷</li>
</ul>
<h4 id="关键bug修复">关键Bug修复</h4>
<ul>
<li><strong>SnapMapper key格式</strong>: 修复了v15.2.x中引入的SnapMapper key格式转换bug</li>
<li><strong>RBD性能</strong>: 修复了<code>rbd perf image iostat</code>和<code>rbd perf image iotop</code>命令的功能</li>
<li><strong>稳定性</strong>: 多项稳定性和性能改进</li>
</ul>
<hr>
<h2 id="pacific">Pacific</h2>
<h3 id="版本发布情况-2">版本发布情况</h3>
<ul>
<li><strong>当前版本</strong>: v16.2.15</li>
<li><strong>版本系列</strong>: v16.2.0 到 v16.2.15</li>
<li><strong>生命周期</strong>: v16.2.15是Pacific系列的最后一个版本，已归档</li>
</ul>
<h3 id="主要亮点-2">主要亮点</h3>
<h4 id="管理简化">管理简化</h4>
<ul>
<li><strong>配置异常检测</strong>: 新增检测配置异常的能力，帮助识别和解决配置问题</li>
<li><strong>集群升级监控</strong>: 新增健康检查<code>DAEMON_OLD_VERSION</code>，当不同版本的Ceph在守护进程上运行时发出警告</li>
<li><strong>进度模块</strong>: MGR progress模块现在可以通过<code>ceph progress on</code>和<code>ceph progress off</code>命令开关</li>
</ul>
<h4 id="存储后端优化">存储后端优化</h4>
<ul>
<li><strong>ceph-volume重写</strong>: <code>lvm batch</code>子命令进行了重大重写，修复了许多错误并改善了可用性</li>
<li><strong>OSD改进</strong>:
<ul>
<li>新增<code>osd_compact_on_start</code>配置选项，在启动时触发OSD压缩（压缩存储引擎数据库以减少空间占用）</li>
<li>改进了OSD快速关闭机制，基于Nautilus引入的<code>osd_fast_shutdown_notify_mon</code>特性进行优化，提升与monitor的通信效率</li>
</ul>
</li>
<li><strong>BlueStore增强</strong>: 多项BlueStore改进和性能优化</li>
</ul>
<h4 id="调度器改进">调度器改进</h4>
<ul>
<li><strong>mclock调度器</strong>:
<ul>
<li><strong>QoS调度</strong>: 经过精炼的mclock调度器，基于mClock算法实现精确的服务质量控制</li>
<li><strong>工作原理</strong>: 通过预留(reservation)、限制(limitation)和权重(weight)三个参数，精确控制不同类型操作的资源分配</li>
<li><strong>内置配置文件</strong>: 提供三种预设配置，用户可根据业务需求选择：
<ul>
<li><strong>high_client_ops</strong> (默认): 为外部客户端操作分配更多OSD带宽，优先保证业务I/O性能</li>
<li><strong>high_recovery_ops</strong>: 优化恢复操作，加快数据重建和修复速度，适合维护窗口使用</li>
<li><strong>balanced</strong>: 平衡配置，在客户端I/O和后台操作之间保持均衡</li>
</ul>
</li>
<li><strong>技术优势</strong>: 相比传统的WRR(加权轮询)调度器，mclock能提供更精确的性能隔离和QoS保证</li>
</ul>
</li>
<li><strong>负载均衡器</strong>:
<ul>
<li><strong>upmap模式</strong>: 现在默认在upmap模式下启用，提供更精确的PG映射控制</li>
<li><strong>客户端要求</strong>: 要求设置<code>require_min_compat_client luminous</code>，确保客户端支持upmap功能</li>
<li><strong>优势</strong>: upmap模式比传统的CRUSH reweight方式能实现更精确的数据分布均衡</li>
</ul>
</li>
</ul>
<h4 id="安全改进">安全改进</h4>
<ul>
<li><strong>身份验证协议</strong>: cephx认证协议版本2 (<code>CEPHX_V2</code>)现在默认必需</li>
<li><strong>重放攻击保护</strong>: 为授权者添加了重放攻击保护，增强了msgr v1消息签名</li>
</ul>
<h4 id="rbd改进">RBD改进</h4>
<ul>
<li><strong>快速差异模式</strong>: 当对时间起点进行差异比较时，在快速差异模式下显著提升性能</li>
<li><strong>缓存优化</strong>: 共享只读父缓存的配置选项<code>immutable_object_cache_watermark</code>更新为0.9</li>
<li><strong>克隆功能</strong>: 支持从非用户类型快照进行克隆</li>
<li><strong>rbd-wnbd驱动</strong>: 获得了多路复用映像映射的能力，提高了Windows环境下的资源使用效率</li>
</ul>
<h4 id="rgw改进">RGW改进</h4>
<ul>
<li><strong>持久化Bucket通知</strong>: 持久化Bucket通知深度整合，提供更可靠的通知机制</li>
<li><strong>AWS兼容API</strong>: 添加了&quot;GetTopicAttributes&quot; API替代现有的&quot;GetTopic&quot; API</li>
<li><strong>日志管理</strong>: <code>bilog-trim</code>、<code>datalog-trim</code>、<code>sync-error-trim</code>现在只接受标记范围的单个标记</li>
</ul>
<h4 id="cephfs改进">CephFS改进</h4>
<ul>
<li><strong>🎯 镜像功能完善</strong>: CephFS镜像功能增强，从Nautilus的基础支持发展为生产可用的解决方案
<ul>
<li><strong>改进同步机制</strong>: 优化的增量同步算法，大幅减少网络带宽占用</li>
<li><strong>生产可用</strong>: 相比Octopus的技术预览版本，Pacific版本达到生产环境部署标准</li>
</ul>
</li>
<li><strong>会话管理</strong>: MDS会驱逐没有推进请求tid的客户端，防止会话元数据大量积累</li>
<li><strong>灾备方案优化</strong>:
<ul>
<li><strong>定时快照</strong>: 增量更新机制，避免全量备份的开销</li>
<li><strong>智能同步</strong>: <code>cephfs-mirror</code>守护进程依靠readdir diff识别目录树中的更改</li>
<li><strong>增量同步</strong>: diff应用于远程文件系统中的目录，仅同步两个快照之间已更改的文件</li>
<li><strong>运维价值</strong>: 为企业级CephFS提供可靠的异地灾备解决方案</li>
</ul>
</li>
</ul>
<h3 id="重要变更">重要变更</h3>
<h4 id="术语变更">术语变更</h4>
<ul>
<li><strong>blacklist → blocklist</strong>: 所有相关命令和配置选项都已更新</li>
<li><strong>命令变更</strong>:
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 旧命令 → 新命令</span>
</span></span><span class="line"><span class="cl">ceph osd blacklist → ceph osd blocklist
</span></span><span class="line"><span class="cl">ceph &lt;tell<span class="p">|</span>daemon&gt; osd.&lt;NNN&gt; dump_blacklist → ceph &lt;tell<span class="p">|</span>daemon&gt; osd.&lt;NNN&gt; dump_blocklist
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="配置变更">配置变更</h4>
<ul>
<li><strong>scrub时间配置</strong>:
<ul>
<li><code>osd_scrub_begin_hour</code>和<code>osd_scrub_end_hour</code>合法值为0-23</li>
<li><code>osd_scrub_begin_week_day</code>和<code>osd_scrub_end_week_day</code>合法值为0-6</li>
</ul>
</li>
<li><strong>监控器配置</strong>: 新增<code>mon_allow_pool_size_one</code>选项，默认禁用</li>
<li><strong>池大小设置</strong>: 设置池大小为1时需要<code>--yes-i-really-mean-it</code>标志</li>
</ul>
<h4 id="api变更">API变更</h4>
<ul>
<li><strong>librados API</strong>:
<ul>
<li><code>rados_blacklist_add</code> → <code>rados_blocklist_add</code></li>
<li><code>get_pool_is_selfmanaged_snaps_mode</code> 已被弃用，建议使用<code>pool_is_in_selfmanaged_snaps_mode</code></li>
</ul>
</li>
</ul>
<h3 id="重要注意事项">重要注意事项</h3>
<ul>
<li><strong>升级路径</strong>: 必须先升级到Octopus (15.2.z)才能升级到Pacific</li>
<li><strong>客户端兼容性</strong>: 新集群默认只支持Luminous及更新的客户端</li>
<li><strong>身份验证</strong>: 默认要求cephx v2协议，旧客户端需要设置配置选项</li>
<li><strong>NFS Ganesha</strong>: 升级前需要删除现有的nfs-ganesha集群，升级后重新部署</li>
<li><strong>术语变更</strong>: 所有blacklist相关术语已更改为blocklist</li>
<li><strong>安全升级</strong>: 建议尽快升级以获得最新的安全修复</li>
</ul>
<hr>
<h2 id="quincy">Quincy</h2>
<h3 id="版本发布情况-3">版本发布情况</h3>
<ul>
<li><strong>当前版本</strong>: v17.2.9</li>
<li><strong>版本系列</strong>: v17.2.0 到 v17.2.9</li>
<li><strong>生命周期</strong>: 已达到生命周期结束（EOL），v17.2.9是最后一个修复版本，已归档</li>
</ul>
<h3 id="主要亮点-3">主要亮点</h3>
<h4 id="dashboard">Dashboard</h4>
<ul>
<li><strong>界面改进</strong>: Dashboard界面改进，提供更好的用户体验</li>
<li><strong>功能增强</strong>: 更多的管理功能和监控能力</li>
</ul>
<h4 id="rados">RADOS</h4>
<ul>
<li><strong>🎯 mclock调度器成熟</strong>: mclock调度器成为默认选项，相比Pacific版本的引入，Quincy版本实现了生产环境的全面部署
<ul>
<li><strong>服务质量保证</strong>: 为Ceph客户端提供相对于后台操作(如recovery、backfill)的服务质量优先级</li>
<li><strong>智能调度</strong>: 根据I/O类型和优先级动态分配资源，确保关键业务不受后台任务影响</li>
<li><strong>配置简化</strong>: 提供预设配置模板，降低调优复杂度</li>
</ul>
</li>
<li><strong>性能优化</strong>: 各种性能改进，提升整体集群性能</li>
<li><strong>API变更</strong>: <code>get_pool_is_selfmanaged_snaps_mode</code> C++ API已被弃用，建议使用更安全的<code>pool_is_in_selfmanaged_snaps_mode</code>替代</li>
</ul>
<h4 id="rbd">RBD</h4>
<ul>
<li><strong>快速差异模式</strong>: 当对时间起点进行差异比较时，在快速差异模式下显著提升性能</li>
<li><strong>命令增强</strong>:
<ul>
<li><code>rbd children</code>命令添加了<code>--image-id</code>选项，可以用于垃圾箱中的镜像</li>
<li>Python绑定中暴露了<code>RBD_IMAGE_OPTION_CLONE_FORMAT</code>选项</li>
<li>Python绑定中暴露了<code>RBD_IMAGE_OPTION_FLATTEN</code>选项</li>
</ul>
</li>
<li><strong>性能优化</strong>: 为QEMU实时磁盘同步和备份用例带来了显著的性能改进</li>
</ul>
<h4 id="cephfs">CephFS</h4>
<ul>
<li><strong>文件系统ID</strong>: 可以指定ID (&ldquo;fscid&rdquo;)创建文件系统，这在某些恢复场景中非常有用</li>
<li><strong>恢复场景</strong>: 例如监控数据库丢失和重建，恢复的文件系统可以拥有与之前相同的ID</li>
<li><strong>文件系统重命名</strong>: 支持使用<code>fs rename</code>命令重命名文件系统</li>
<li><strong>MDS升级</strong>: MDS升级不再需要在升级文件系统的唯一活动MDS之前停止所有备用MDS守护进程</li>
<li><strong>故障处理</strong>: 备用重放守护进程无法重放日志时，现在会将等级标记为&quot;damaged&quot;</li>
</ul>
<h4 id="其他功能">其他功能</h4>
<ul>
<li><strong>SQLite支持</strong>: 新库libcephsqlite现已推出</li>
<li><strong>虚拟文件系统</strong>: 在RADOS之上提供SQLite虚拟文件系统(VFS)</li>
<li><strong>数据条带化</strong>: 数据库和日志通过RADOS跨多个对象进行条带化</li>
<li><strong>可扩展性</strong>: 几乎可以无限扩展，吞吐量仅受SQLite客户端限制</li>
<li><strong>LevelDB迁移</strong>: 要求从LevelDB迁移到RocksDB（如果适用）</li>
</ul>
<hr>
<h2 id="reef">Reef</h2>
<p>Reef是Ceph的第18个稳定版本，以reef squid (Sepioteuthis)命名。</p>
<h3 id="版本发布情况-4">版本发布情况</h3>
<ul>
<li><strong>当前版本</strong>: v18.2.7 (推荐所有用户升级)</li>
<li><strong>版本系列</strong>: v18.2.0 到 v18.2.7</li>
<li><strong>生命周期</strong>: 当前活跃的稳定版本</li>
<li><strong>⚠️ 关键修复</strong>: v18.2.7修复了18.2.5和18.2.6版本中的严重BlueStore回归问题
<ul>
<li><strong>问题描述</strong>: BlueStore在处理大型对象(&gt;4MB)时出现数据完整性问题，可能导致对象读取错误或损坏</li>
<li><strong>影响范围</strong>: 主要影响RGW大文件上传、RBD大块写入等场景，可能引起静默数据损坏</li>
<li><strong>回归原因</strong>: v18.2.5中引入的BlueStore压缩优化代码存在边界条件处理错误</li>
<li><strong>修复措施</strong>: 回滚了有问题的压缩优化，并增加了额外的数据完整性校验</li>
<li><strong>升级建议</strong>: 如果正在使用v18.2.5或v18.2.6，强烈建议立即升级到v18.2.7</li>
</ul>
</li>
</ul>
<h3 id="主要亮点-4">主要亮点</h3>
<h4 id="主要功能">主要功能</h4>
<ul>
<li><strong>FileStore弃用</strong>: FileStore在Reef中不再受支持，用户需要迁移到BlueStore</li>
<li><strong>RocksDB升级</strong>: RocksDB已升级到版本7.9.2，性能有显著改进</li>
<li><strong>命令更新</strong>: <code>perf dump</code>和<code>perf schema</code>命令已被弃用，取而代之的是新的<code>counter dump</code>和<code>counter schema</code>命令</li>
<li><strong>缓存分层弃用</strong>: 缓存分层现在已被弃用</li>
<li><strong>读取平衡器</strong>: 新功能&quot;读取平衡器&quot;现已可用，允许用户在集群上平衡每个池的主PG</li>
<li><strong>新命令</strong>: 添加了<code>ceph osd rm-pg-upmap-primary-all</code>命令，允许用户清除osdmap中的所有pg-upmap-primary映射</li>
</ul>
<h4 id="rgw">RGW</h4>
<ul>
<li><strong>存储桶重新分片</strong>: 多站点配置现在支持存储桶重新分片</li>
<li><strong>多站点复制</strong>: 多站点复制的稳定性和一致性有显著改进</li>
<li><strong>加密压缩</strong>: 现在支持使用服务器端加密上传的对象的压缩</li>
<li><strong>安全考虑</strong>: 在启用<code>compress-encrypted</code>区域组功能之前，必须将所有区域升级到Reef</li>
</ul>
<h4 id="dashboard-1">Dashboard</h4>
<ul>
<li><strong>新页面</strong>: 有一个改进布局的新Dashboard页面</li>
<li><strong>卡片显示</strong>: 活动警报和一些重要图表现在显示在卡片内</li>
</ul>
<h4 id="rbd-1">RBD</h4>
<ul>
<li><strong>分层加密</strong>: 添加了对分层客户端加密的支持</li>
<li><strong>NBD映射</strong>: <code>try-netlink</code>映射选项现在成为默认选项并已弃用，如果内核不支持NBD netlink接口，则会使用传统ioctl接口重试</li>
</ul>
<h4 id="遥测">遥测</h4>
<ul>
<li><strong>排行榜</strong>: 用户现在可以选择参与遥测公共仪表板中的排行榜 (<a href="https://telemetry-public.ceph.com/">公共仪表板</a>)</li>
<li><strong>集群描述</strong>: 用户可以提供集群描述，将在排行榜中公开显示</li>
<li><strong>相关命令</strong>:
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看遥测预览</span>
</span></span><span class="line"><span class="cl">ceph telemetry preview
</span></span><span class="line"><span class="cl"><span class="c1"># 开启遥测</span>
</span></span><span class="line"><span class="cl">ceph telemetry on
</span></span><span class="line"><span class="cl"><span class="c1"># 开启排行榜</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mgr mgr/telemetry/leaderboard <span class="nb">true</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 添加排行榜描述</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mgr mgr/telemetry/leaderboard_description <span class="s1">&#39;Cluster description&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h2 id="squid">Squid</h2>
<p>Squid是Ceph的第19个稳定版本，是当前活跃的稳定版本。</p>
<h3 id="版本发布情况-5">版本发布情况</h3>
<ul>
<li><strong>当前版本</strong>: v19.2.2 (推荐所有用户升级)</li>
<li><strong>版本系列</strong>: v19.2.0 到 v19.2.x</li>
<li><strong>生命周期</strong>: 当前活跃的稳定版本</li>
<li><strong>重要修复</strong>: v19.2.2修复了RGW CopyObject数据丢失的关键bug</li>
<li><strong>技术预览</strong>: Crimson/Seastore技术预览版本，支持RBD工作负载在复制池上运行</li>
</ul>
<h3 id="主要亮点-5">主要亮点</h3>
<h4 id="dashboard界面改进">Dashboard界面改进</h4>
<ul>
<li><strong>重新设计的导航布局</strong>: 导航布局已重新组织，提升可用性和关键功能的访问便利性</li>
<li><strong>CephFS快照和克隆管理</strong>: 支持管理CephFS快照和克隆，以及快照调度管理</li>
<li><strong>授权管理</strong>: 管理CephFS资源的授权能力</li>
<li><strong>挂载助手</strong>: 提供CephFS卷挂载的帮助工具</li>
</ul>
<h4 id="核心功能改进">核心功能改进</h4>
<ul>
<li><strong>CephFS子卷标记</strong>: <code>fs subvolume create</code>命令现在支持通过<code>--earmark</code>选项为子卷添加标记</li>
<li><strong>扩展属性</strong>: 扩展了CephFS虚拟扩展属性的removexattr支持</li>
<li><strong>用户账户</strong>: RGW用户账户功能解锁了多个AWS兼容的IAM API，用于自服务管理用户、密钥、组、角色、策略等</li>
</ul>
<h4 id="rados改进">RADOS改进</h4>
<ul>
<li><strong>平衡器性能</strong>: 修复了平衡器mgr模块的性能瓶颈</li>
<li><strong>HDD配置优化</strong>: 基于大规模测试，优化了HDD OSD的默认分片配置：
<ul>
<li><code>osd_op_num_shards_hdd = 1</code> (原来是5)</li>
<li><code>osd_op_num_threads_per_shard_hdd = 5</code> (原来是1)</li>
</ul>
</li>
<li><strong>BlueStore优化</strong>: BlueStore针对快照密集型工作负载进行了优化</li>
<li><strong>RocksDB压缩</strong>: BlueStore RocksDB LZ4压缩现在默认启用，提高平均性能和&quot;快速设备&quot;空间使用</li>
<li><strong>CRUSH规则</strong>: 新的CRUSH规则类型MSR（多步重试）允许更灵活的EC配置</li>
</ul>
<h4 id="管理器模块改进">管理器模块改进</h4>
<ul>
<li><strong>REST模块</strong>: REST管理器模块现在会根据<code>max_requests</code>选项修剪请求，防止内存不足(OOM)问题</li>
</ul>
<h4 id="rgw增强">RGW增强</h4>
<ul>
<li><strong>Topic所有权</strong>: SNS topics现在有所有者概念，默认只有所有者可以读写</li>
<li><strong>Topic策略</strong>: 支持topic策略文档来授予权限给其他用户</li>
<li><strong>持久化通知</strong>: 修复了持久化通知中topic参数修改的问题</li>
<li><strong>用户ID</strong>: 在bucket通知中，<code>ownerIdentity</code>内的<code>principalId</code>现在包含完整的用户ID</li>
<li><strong>版本化bucket</strong>: 新增工具来识别和修正版本化bucket索引的问题</li>
</ul>
<h4 id="遥测改进">遥测改进</h4>
<ul>
<li><strong>基本频道</strong>: 遥测的<code>basic</code>频道现在捕获池标志，帮助了解功能采用情况</li>
<li><strong>遥测命令</strong>: 使用<code>ceph telemetry on</code>可以选择加入遥测</li>
</ul>
<h3 id="重要修复">重要修复</h3>
<h4 id="数据安全修复">数据安全修复</h4>
<ul>
<li><strong>RGW数据丢失</strong>: 修复了关键的CopyObject复制对象到自身时的数据丢失bug（v19.2.2中修复）</li>
<li><strong>垃圾收集</strong>: 解决了尾部对象被错误标记为垃圾收集的问题</li>
<li><strong>恢复工具</strong>: 提供了实验性的<code>rgw-gap-list</code>工具来识别损坏的对象</li>
<li><strong>重要安全修复</strong>: 修复了可能导致数据丢失的关键安全问题</li>
</ul>
<h4 id="性能和稳定性">性能和稳定性</h4>
<ul>
<li><strong>内核设备</strong>: 一系列针对内核设备discard的优化</li>
<li><strong>消息传递</strong>: 修复了AsyncMessenger中的连接计数问题</li>
<li><strong>BlueStore</strong>: 多项BlueStore改进和bug修复</li>
<li><strong>平衡器性能</strong>: 修复了平衡器mgr模块的性能瓶颈</li>
<li><strong>HDD配置优化</strong>: 优化了HDD OSD的默认分片配置以提高mClock调度性能</li>
</ul>
<hr>
<h2 id="参考资料">参考资料</h2>
<h3 id="官方文档">官方文档</h3>
<ul>
<li><a href="https://docs.ceph.com/">Ceph官方文档</a></li>
<li><a href="https://docs.ceph.com/en/latest/releases/">Ceph版本发布说明</a></li>
<li><a href="https://docs.ceph.com/en/latest/dev/">Ceph开发者文档</a></li>
</ul>
<h3 id="技术文章">技术文章</h3>
<ul>
<li><a href="https://ceph.io/en/news/blog/2018/new-mimic-centralized-configuration-management/">New in Mimic: Centralized Configuration Management</a></li>
<li><a href="https://ceph.io/en/news/blog/2019/new-in-nautilus-crash-dump-telemetry/">New in Nautilus: Crash Dump Telemetry</a></li>
<li><a href="https://ceph.io/en/news/blog/2020/new-in-octopus-dashboard-features/">New in Octopus: Dashboard Features</a></li>
</ul>
<h3 id="技术讲座">技术讲座</h3>
<ul>
<li>Ceph Tech Talk - What&rsquo;s New In Octopus</li>
<li>Ceph Developer Summit Quincy: RADOS Follow-up</li>
<li>Diving Deep with Squid</li>
</ul>
<h2 id="特别说明">特别说明</h2>
<p>本文仅供参考，如果有错误的地方，请指正</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">ceph-deep-dive</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2025-06-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/ceph/">ceph</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/ceph-content/application-practice/en/analysis-of-io-commit-latency-spike-in-ceph-cluster/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Analysis of IO Commit Latency Spike in Ceph Cluster</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/ceph-content/application-practice/zh-cn/ceph%E9%9B%86%E7%BE%A4io%E6%8F%90%E4%BA%A4%E5%BB%B6%E8%BF%9F%E7%BB%9F%E8%AE%A1%E8%B7%B3%E5%8F%98%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/">
            <span class="next-text nav-default">Ceph集群IO提交延迟统计跳变问题分析</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="YLShiJustFly/YLShiJustFly.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:youseeicanfly@126.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.zhihu.com/people/tan-xi-liu-nian" class="iconfont icon-zhihu" title="zhihu"></a>
  <a href="http://YLShiJustFly.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2022 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span>ceph-deep-dive</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.191509a5c8442abdb6eb5020a332fd59bdd83a7e78a2d2241108df9113504292.js"></script>








</body>
</html>
