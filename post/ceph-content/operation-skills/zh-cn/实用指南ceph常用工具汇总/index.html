<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title> - Friends&#39; Life and Work Space</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="YLShi && WuHongSong" /><meta name="description" content="📋 常用工具(汇总简略不全版) 功能分类 主要命令 验证状态 使用频率 适用场景 风险级别 集群监控 ceph -s, ceph health(detail), ceph df, ceph -w ✅ 已验证 ⭐⭐⭐⭐⭐ 日常监控、故障诊断 🟢 无" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.100.2 with theme even" />


<link rel="canonical" href="http://YLShiJustFly.github.io/post/ceph-content/operation-skills/zh-cn/%E5%AE%9E%E7%94%A8%E6%8C%87%E5%8D%97ceph%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="" />
<meta property="og:description" content="📋 常用工具(汇总简略不全版) 功能分类 主要命令 验证状态 使用频率 适用场景 风险级别 集群监控 ceph -s, ceph health(detail), ceph df, ceph -w ✅ 已验证 ⭐⭐⭐⭐⭐ 日常监控、故障诊断 🟢 无" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://YLShiJustFly.github.io/post/ceph-content/operation-skills/zh-cn/%E5%AE%9E%E7%94%A8%E6%8C%87%E5%8D%97ceph%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E6%B1%87%E6%80%BB/" /><meta property="article:section" content="post" />



<meta itemprop="name" content="">
<meta itemprop="description" content="📋 常用工具(汇总简略不全版) 功能分类 主要命令 验证状态 使用频率 适用场景 风险级别 集群监控 ceph -s, ceph health(detail), ceph df, ceph -w ✅ 已验证 ⭐⭐⭐⭐⭐ 日常监控、故障诊断 🟢 无">

<meta itemprop="wordCount" content="5831">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="📋 常用工具(汇总简略不全版) 功能分类 主要命令 验证状态 使用频率 适用场景 风险级别 集群监控 ceph -s, ceph health(detail), ceph df, ceph -w ✅ 已验证 ⭐⭐⭐⭐⭐ 日常监控、故障诊断 🟢 无"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Friends&#39; Life and Work Space</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Friends&#39; Life and Work Space</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title"></h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
          <span class="more-meta"> 5831 words </span>
          <span class="more-meta"> 12 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#-常用工具汇总简略不全版">📋 常用工具(汇总简略不全版)</a></li>
        <li><a href="#-1-集群状态监控">🔧 1. 集群状态监控</a>
          <ul>
            <li><a href="#11-集群整体状态">1.1 集群整体状态</a></li>
            <li><a href="#12-集群性能监控">1.2 集群性能监控</a></li>
          </ul>
        </li>
        <li><a href="#-2-osd-管理">🗄️ 2. OSD 管理</a>
          <ul>
            <li><a href="#21-osd-基本操作">2.1 OSD 基本操作</a></li>
            <li><a href="#22-osd-维护操作">2.2 OSD 维护操作</a></li>
            <li><a href="#23-osd-故障排查">2.3 OSD 故障排查</a></li>
          </ul>
        </li>
        <li><a href="#-3-monitor-管理">🏛️ 3. Monitor 管理</a>
          <ul>
            <li><a href="#31-monitor-基本操作">3.1 Monitor 基本操作</a></li>
            <li><a href="#32-monitor-维护">3.2 Monitor 维护</a></li>
          </ul>
        </li>
        <li><a href="#-4-manager-管理">👨‍💼 4. Manager 管理</a>
          <ul>
            <li><a href="#41-manager-基本操作">4.1 Manager 基本操作</a></li>
            <li><a href="#42-常用-manager-模块">4.2 常用 Manager 模块</a></li>
          </ul>
        </li>
        <li><a href="#-5-存储池管理">🗂️ 5. 存储池管理</a>
          <ul>
            <li><a href="#51-pool-基本操作">5.1 Pool 基本操作</a></li>
            <li><a href="#52-pool-参数配置">5.2 Pool 参数配置</a></li>
          </ul>
        </li>
        <li><a href="#-6-放置组-pg-管理">📄 6. 放置组 (PG) 管理</a>
          <ul>
            <li><a href="#61-pg-状态查看">6.1 PG 状态查看</a></li>
            <li><a href="#62-pg-修复操作">6.2 PG 修复操作</a></li>
          </ul>
        </li>
        <li><a href="#-7-认证管理">🔐 7. 认证管理</a>
          <ul>
            <li><a href="#71-用户管理">7.1 用户管理</a></li>
            <li><a href="#72-权限管理">7.2 权限管理</a></li>
          </ul>
        </li>
        <li><a href="#-8-crush-map-管理">🏗️ 8. CRUSH Map 管理</a>
          <ul>
            <li><a href="#81-crush-基本操作">8.1 CRUSH 基本操作</a></li>
            <li><a href="#82-crush-规则管理">8.2 CRUSH 规则管理</a></li>
          </ul>
        </li>
        <li><a href="#-9-rbd-管理">🎯 9. RBD 管理</a>
          <ul>
            <li><a href="#91-rbd-基本操作">9.1 RBD 基本操作</a></li>
            <li><a href="#92-rbd-高级操作">9.2 RBD 高级操作</a></li>
          </ul>
        </li>
        <li><a href="#-10-cephfs-管理">🌐 10. CephFS 管理</a>
          <ul>
            <li><a href="#101-cephfs-基本操作">10.1 CephFS 基本操作</a></li>
            <li><a href="#102-cephfs-客户端">10.2 CephFS 客户端</a></li>
            <li><a href="#103-cephfs-高级管理">10.3 CephFS 高级管理</a></li>
          </ul>
        </li>
        <li><a href="#-11-rgw-管理">☁️ 11. RGW 管理</a>
          <ul>
            <li><a href="#111-rgw-基本操作">11.1 RGW 基本操作</a></li>
            <li><a href="#112-rgw-密钥管理">11.2 RGW 密钥管理</a></li>
            <li><a href="#113-rgw-维护">11.3 RGW 维护</a></li>
          </ul>
        </li>
        <li><a href="#-12-配置管理">🔧 12. 配置管理</a>
          <ul>
            <li><a href="#121-运行时配置">12.1 运行时配置</a></li>
            <li><a href="#122-临时配置调整">12.2 临时配置调整</a></li>
          </ul>
        </li>
        <li><a href="#-13-性能分析专项">📈 13. 性能分析专项</a>
          <ul>
            <li><a href="#131-rbd-性能分析">13.1 RBD 性能分析</a></li>
            <li><a href="#132-cephfs-性能分析">13.2 CephFS 性能分析</a></li>
            <li><a href="#133-osd-性能分析">13.3 OSD 性能分析</a></li>
            <li><a href="#134-整体集群性能分析">13.4 整体集群性能分析</a></li>
          </ul>
        </li>
        <li><a href="#-14-ceph-专用工具集">🛠️ 14. Ceph 专用工具集</a>
          <ul>
            <li><a href="#141-数据恢复和诊断工具">14.1 数据恢复和诊断工具</a></li>
            <li><a href="#142-监控和管理工具">14.2 监控和管理工具</a></li>
            <li><a href="#143-数据迁移和同步工具">14.3 数据迁移和同步工具</a></li>
          </ul>
        </li>
        <li><a href="#-15-故障排查">🚨 15. 故障排查</a>
          <ul>
            <li><a href="#151-日志查看">15.1 日志查看</a></li>
            <li><a href="#152-常见问题排查">15.2 常见问题排查</a></li>
          </ul>
        </li>
        <li><a href="#-16-备份恢复">🔄 16. 备份恢复</a>
          <ul>
            <li><a href="#161-数据备份">16.1 数据备份</a></li>
            <li><a href="#162-灾难恢复">16.2 灾难恢复</a></li>
            <li><a href="#163-rbd-备份恢复">16.3 RBD 备份恢复</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="-常用工具汇总简略不全版">📋 常用工具(汇总简略不全版)</h2>
<table>
<thead>
<tr>
<th>功能分类</th>
<th>主要命令</th>
<th>验证状态</th>
<th>使用频率</th>
<th>适用场景</th>
<th>风险级别</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>集群监控</strong></td>
<td><code>ceph -s</code>, <code>ceph health(detail)</code>, <code>ceph df</code>, <code>ceph -w</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐⭐⭐</td>
<td>日常监控、故障诊断</td>
<td>🟢 无风险</td>
</tr>
<tr>
<td><strong>I/O监控</strong></td>
<td><code>ceph iostat</code>(版本相关,N以上), <code>ceph -w</code>, <code>ceph status</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐⭐</td>
<td>性能监控</td>
<td>🟢 无风险</td>
</tr>
<tr>
<td><strong>OSD管理</strong></td>
<td><code>ceph osd tree</code>, <code>ceph osd status</code>, <code>ceph osd out/in</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐⭐</td>
<td>OSD维护、容量管理</td>
<td>🟡 中等风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>Monitor管理</strong></td>
<td><code>ceph mon stat</code>, <code>ceph quorum_status</code>, <code>ceph mon add/remove</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐</td>
<td>集群管理、高可用</td>
<td>🔴 高风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>Manager管理</strong></td>
<td><code>ceph mgr module enable/disable</code>, <code>ceph mgr stat</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐</td>
<td>功能管理、仪表板</td>
<td>🟡 中等风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>存储池管理</strong></td>
<td><code>ceph osd pool create/delete</code>, <code>ceph osd pool set</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐⭐</td>
<td>存储规划、配额管理</td>
<td>🔴 高风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>PG管理</strong></td>
<td><code>ceph pg stat</code>, <code>ceph pg repair</code>, <code>ceph pg scrub</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐⭐</td>
<td>数据完整性、故障修复</td>
<td>🟡 中等风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>认证管理</strong></td>
<td><code>ceph auth list/create/del</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐</td>
<td>安全管理、权限控制</td>
<td>🔴 高风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>CRUSH管理</strong></td>
<td><code>ceph osd crush tree</code>, <code>crushtool</code>, <code>ceph osd crush rule</code></td>
<td>✅ 已验证</td>
<td>⭐⭐</td>
<td>数据分布、故障域</td>
<td>🔴 高风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>RBD管理</strong></td>
<td><code>rbd create/rm</code>, <code>rbd snap create</code>, <code>rbd map/unmap</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐⭐</td>
<td>块存储、快照管理</td>
<td>🟡 中等风险</td>
</tr>
<tr>
<td><strong>CephFS管理</strong></td>
<td><code>ceph fs status</code>, <code>ceph mds stat</code>, <code>ceph fs dump</code>, <code>ceph mds fail</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐</td>
<td>文件系统、元数据</td>
<td>🟡 中等风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>RGW管理</strong></td>
<td><code>radosgw-admin user create</code>, <code>radosgw-admin bucket</code></td>
<td>✅ 已验证</td>
<td>⭐⭐⭐</td>
<td>对象存储、用户管理</td>
<td>🟡 中等风险  (查询无风险)</td>
</tr>
<tr>
<td><strong>配置管理</strong></td>
<td><code>ceph config set/get</code>, <code>ceph tell</code></td>
<td>未验证</td>
<td>⭐⭐⭐⭐</td>
<td>参数调优、故障处理</td>
<td>🟡 中等风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>性能分析</strong></td>
<td><code>ceph osd perf</code>,<code>rbd perf image iostat</code>, cephfs-top</td>
<td>✅ 已验证</td>
<td>⭐⭐⭐</td>
<td>性能测试、瓶颈分析</td>
<td>🟢 无风险</td>
</tr>
<tr>
<td><strong>专用工具</strong></td>
<td><code>ceph-objectstore-tool</code>, <code>ceph-bluestore-tool</code></td>
<td>✅ 已验证</td>
<td>⭐⭐</td>
<td>数据恢复、深度诊断</td>
<td>🔴 高风险 (查询无风险)</td>
</tr>
<tr>
<td><strong>故障排查</strong></td>
<td><code>journalctl</code>, <code>ceph daemon dump</code>, 日志分析</td>
<td>✅ 已验证</td>
<td>⭐⭐⭐⭐</td>
<td>问题诊断、根因分析</td>
<td>🟢 无风险</td>
</tr>
<tr>
<td><strong>备份恢复</strong></td>
<td><code>ceph mon getmap</code>, <code>ceph auth export</code>, 数据导出</td>
<td>✅ 已验证</td>
<td>⭐⭐</td>
<td>灾难恢复、迁移</td>
<td>🟡 中等风险 (查询无风险)</td>
</tr>
</tbody>
</table>
<h2 id="-1-集群状态监控">🔧 1. 集群状态监控</h2>
<h3 id="11-集群整体状态">1.1 集群整体状态</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看集群状态（最常用）</span>
</span></span><span class="line"><span class="cl">ceph status
</span></span><span class="line"><span class="cl">ceph -s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看集群健康状态</span>
</span></span><span class="line"><span class="cl">ceph health
</span></span><span class="line"><span class="cl">ceph health detail
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 实时监控集群状态</span>
</span></span><span class="line"><span class="cl">ceph -w
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看集群存储使用情况</span>
</span></span><span class="line"><span class="cl">ceph df
</span></span><span class="line"><span class="cl">ceph df detail
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看集群版本信息</span>
</span></span><span class="line"><span class="cl">ceph version
</span></span><span class="line"><span class="cl">ceph versions
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="12-集群性能监控">1.2 集群性能监控</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看集群 I/O 统计</span>
</span></span><span class="line"><span class="cl">ceph iostat
</span></span><span class="line"><span class="cl">watch <span class="s2">&#34;ceph iostat&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 OSD 性能统计</span>
</span></span><span class="line"><span class="cl">ceph osd perf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看慢请求</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.X dump_slow_requests
</span></span><span class="line"><span class="cl">ceph daemon osd.X dump_historic_slow_ops
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># PG 分布分析</span>
</span></span><span class="line"><span class="cl">ceph pg dump <span class="p">|</span> grep ^pg <span class="p">|</span> awk <span class="s1">&#39;{print $1,$15}&#39;</span> <span class="p">|</span> sort
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-2-osd-管理">🗄️ 2. OSD 管理</h2>
<h3 id="21-osd-基本操作">2.1 OSD 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 OSD 状态</span>
</span></span><span class="line"><span class="cl">ceph osd stat
</span></span><span class="line"><span class="cl">ceph osd dump
</span></span><span class="line"><span class="cl">ceph osd tree
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 OSD 使用情况</span>
</span></span><span class="line"><span class="cl">ceph osd df
</span></span><span class="line"><span class="cl">ceph osd df tree
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启动/停止 OSD</span>
</span></span><span class="line"><span class="cl">systemctl start ceph-osd@X
</span></span><span class="line"><span class="cl">systemctl stop ceph-osd@X
</span></span><span class="line"><span class="cl">systemctl restart ceph-osd@X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 将 OSD 标记为 out/in</span>
</span></span><span class="line"><span class="cl">ceph osd out X
</span></span><span class="line"><span class="cl">ceph osd in X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 将 OSD 标记为 down/up</span>
</span></span><span class="line"><span class="cl">ceph osd down X
</span></span><span class="line"><span class="cl">ceph osd up X
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-osd-维护操作">2.2 OSD 维护操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 安全移除 OSD（完整流程）</span>
</span></span><span class="line"><span class="cl">ceph osd out X                              <span class="c1"># 标记为out，开始数据迁移</span>
</span></span><span class="line"><span class="cl">ceph osd safe-to-destroy X                  <span class="c1"># 检查是否安全移除</span>
</span></span><span class="line"><span class="cl">ceph osd destroy X --yes-i-really-mean-it   <span class="c1"># 销毁OSD</span>
</span></span><span class="line"><span class="cl">ceph osd crush remove osd.X                 <span class="c1"># 从CRUSH map移除</span>
</span></span><span class="line"><span class="cl">ceph auth del osd.X                         <span class="c1"># 删除认证信息</span>
</span></span><span class="line"><span class="cl">ceph osd rm X                               <span class="c1"># 从集群移除</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 替换故障 OSD</span>
</span></span><span class="line"><span class="cl">ceph osd destroy X --yes-i-really-mean-it
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重新权衡 OSD</span>
</span></span><span class="line"><span class="cl">ceph osd reweight X 0.8                     <span class="c1"># 临时权重调整</span>
</span></span><span class="line"><span class="cl">ceph osd crush reweight osd.X 2.0           <span class="c1"># 永久权重调整</span>
</span></span><span class="line"><span class="cl">ceph osd reweight-by-utilization            <span class="c1"># 按使用率自动调整权重</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="23-osd-故障排查">2.3 OSD 故障排查</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 OSD 详细信息</span>
</span></span><span class="line"><span class="cl">ceph osd find X
</span></span><span class="line"><span class="cl">ceph osd metadata X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 OSD 日志</span>
</span></span><span class="line"><span class="cl">journalctl -u ceph-osd@X -f
</span></span><span class="line"><span class="cl">journalctl -u ceph-osd@X --since <span class="s2">&#34;1 hour ago&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修复 OSD</span>
</span></span><span class="line"><span class="cl">ceph osd scrub X
</span></span><span class="line"><span class="cl">ceph osd deep-scrub X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 OSD 的 PG</span>
</span></span><span class="line"><span class="cl">ceph pg ls-by-osd X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># OSD 性能诊断</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.X perf dump
</span></span><span class="line"><span class="cl">ceph daemon osd.X dump_ops_in_flight
</span></span><span class="line"><span class="cl">ceph daemon osd.X dump_blocked_ops
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-3-monitor-管理">🏛️ 3. Monitor 管理</h2>
<h3 id="31-monitor-基本操作">3.1 Monitor 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 Monitor 状态</span>
</span></span><span class="line"><span class="cl">ceph mon stat
</span></span><span class="line"><span class="cl">ceph mon dump
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 Monitor 仲裁状态</span>
</span></span><span class="line"><span class="cl">ceph quorum_status
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 添加 Monitor</span>
</span></span><span class="line"><span class="cl">ceph mon add &lt;mon-id&gt; &lt;mon-addr&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 移除 Monitor</span>
</span></span><span class="line"><span class="cl">ceph mon remove &lt;mon-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 Monitor 映射</span>
</span></span><span class="line"><span class="cl">ceph mon getmap -o /tmp/monmap
</span></span><span class="line"><span class="cl">monmaptool --print /tmp/monmap
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="32-monitor-维护">3.2 Monitor 维护</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 启动/停止 Monitor</span>
</span></span><span class="line"><span class="cl">systemctl start ceph-mon@&lt;hostname&gt;
</span></span><span class="line"><span class="cl">systemctl stop ceph-mon@&lt;hostname&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 压缩 Monitor 数据库</span>
</span></span><span class="line"><span class="cl">ceph tell mon.&lt;mon-id&gt; compact
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 同步 Monitor 时间</span>
</span></span><span class="line"><span class="cl">ceph time-sync-status
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Monitor 故障恢复</span>
</span></span><span class="line"><span class="cl">ceph-mon --extract-monmap /tmp/monmap --mon-data /var/lib/ceph/mon/ceph-&lt;id&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-4-manager-管理">👨‍💼 4. Manager 管理</h2>
<h3 id="41-manager-基本操作">4.1 Manager 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 Manager 状态</span>
</span></span><span class="line"><span class="cl">ceph mgr stat
</span></span><span class="line"><span class="cl">ceph mgr dump
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启用/禁用 Manager 模块</span>
</span></span><span class="line"><span class="cl">ceph mgr module <span class="nb">enable</span> &lt;module&gt;
</span></span><span class="line"><span class="cl">ceph mgr module disable &lt;module&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看可用模块</span>
</span></span><span class="line"><span class="cl">ceph mgr module ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 故障转移 Manager</span>
</span></span><span class="line"><span class="cl">ceph mgr fail &lt;mgr-id&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-常用-manager-模块">4.2 常用 Manager 模块</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Dashboard 模块</span>
</span></span><span class="line"><span class="cl">ceph mgr module <span class="nb">enable</span> dashboard
</span></span><span class="line"><span class="cl">ceph dashboard create-self-signed-cert
</span></span><span class="line"><span class="cl">ceph dashboard ac-user-create &lt;username&gt; -i &lt;password-file&gt;
</span></span><span class="line"><span class="cl">ceph dashboard ac-role-add-scope-perms admin read-write pool
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mgr mgr/dashboard/server_addr 0.0.0.0
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mgr mgr/dashboard/server_port <span class="m">8443</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Prometheus 模块</span>
</span></span><span class="line"><span class="cl">ceph mgr module <span class="nb">enable</span> prometheus
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mgr mgr/prometheus/server_addr 0.0.0.0
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mgr mgr/prometheus/server_port <span class="m">9283</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Balancer 模块</span>
</span></span><span class="line"><span class="cl">ceph mgr module <span class="nb">enable</span> balancer
</span></span><span class="line"><span class="cl">ceph balancer mode upmap
</span></span><span class="line"><span class="cl">ceph balancer on
</span></span><span class="line"><span class="cl">ceph balancer status
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Alerts 模块</span>
</span></span><span class="line"><span class="cl">ceph mgr module <span class="nb">enable</span> alerts
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-5-存储池管理">🗂️ 5. 存储池管理</h2>
<h3 id="51-pool-基本操作">5.1 Pool 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 创建存储池</span>
</span></span><span class="line"><span class="cl">ceph osd pool create &lt;poolname&gt; &lt;pg_num&gt; <span class="o">[</span>pgp_num<span class="o">]</span>
</span></span><span class="line"><span class="cl">ceph osd pool create rbd <span class="m">128</span> <span class="m">128</span> replicated
</span></span><span class="line"><span class="cl">ceph osd pool create mypool <span class="m">64</span> <span class="m">64</span> erasure
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除存储池</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> mon mon_allow_pool_delete <span class="nb">true</span>
</span></span><span class="line"><span class="cl">ceph osd pool delete &lt;poolname&gt; &lt;poolname&gt; --yes-i-really-really-mean-it
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看存储池</span>
</span></span><span class="line"><span class="cl">ceph osd lspools
</span></span><span class="line"><span class="cl">ceph osd pool ls detail
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置存储池配额</span>
</span></span><span class="line"><span class="cl">ceph osd pool set-quota &lt;poolname&gt; max_objects <span class="m">1000</span>
</span></span><span class="line"><span class="cl">ceph osd pool set-quota &lt;poolname&gt; max_bytes 1TB
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看存储池统计</span>
</span></span><span class="line"><span class="cl">ceph osd pool stats
</span></span><span class="line"><span class="cl">ceph osd pool stats &lt;poolname&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="52-pool-参数配置">5.2 Pool 参数配置</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 设置存储池副本数</span>
</span></span><span class="line"><span class="cl">ceph osd pool <span class="nb">set</span> &lt;poolname&gt; size <span class="m">3</span>
</span></span><span class="line"><span class="cl">ceph osd pool <span class="nb">set</span> &lt;poolname&gt; min_size <span class="m">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置 PG 数量</span>
</span></span><span class="line"><span class="cl">ceph osd pool <span class="nb">set</span> &lt;poolname&gt; pg_num <span class="m">128</span>
</span></span><span class="line"><span class="cl">ceph osd pool <span class="nb">set</span> &lt;poolname&gt; pgp_num <span class="m">128</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置存储池类型</span>
</span></span><span class="line"><span class="cl">ceph osd pool <span class="nb">set</span> &lt;poolname&gt; crush_rule &lt;rule-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 启用/禁用功能</span>
</span></span><span class="line"><span class="cl">ceph osd pool <span class="nb">set</span> &lt;poolname&gt; noscrub <span class="nb">true</span>
</span></span><span class="line"><span class="cl">ceph osd pool <span class="nb">set</span> &lt;poolname&gt; nodeep-scrub <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pool 应用标签</span>
</span></span><span class="line"><span class="cl">ceph osd pool application <span class="nb">enable</span> &lt;poolname&gt; rbd
</span></span><span class="line"><span class="cl">ceph osd pool application <span class="nb">enable</span> &lt;poolname&gt; cephfs
</span></span><span class="line"><span class="cl">ceph osd pool application <span class="nb">enable</span> &lt;poolname&gt; rgw
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-6-放置组-pg-管理">📄 6. 放置组 (PG) 管理</h2>
<h3 id="61-pg-状态查看">6.1 PG 状态查看</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 PG 状态</span>
</span></span><span class="line"><span class="cl">ceph pg stat
</span></span><span class="line"><span class="cl">ceph pg dump
</span></span><span class="line"><span class="cl">ceph pg dump --format json-pretty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看异常 PG</span>
</span></span><span class="line"><span class="cl">ceph pg dump_stuck
</span></span><span class="line"><span class="cl">ceph pg dump_stuck inactive
</span></span><span class="line"><span class="cl">ceph pg dump_stuck unclean
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看特定 PG 信息</span>
</span></span><span class="line"><span class="cl">ceph pg &lt;pgid&gt; query
</span></span><span class="line"><span class="cl">ceph pg map &lt;pgid&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="62-pg-修复操作">6.2 PG 修复操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 修复 PG</span>
</span></span><span class="line"><span class="cl">ceph pg repair &lt;pgid&gt;
</span></span><span class="line"><span class="cl">ceph pg scrub &lt;pgid&gt;
</span></span><span class="line"><span class="cl">ceph pg deep-scrub &lt;pgid&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 强制修复不一致的对象</span>
</span></span><span class="line"><span class="cl">ceph pg force-recovery &lt;pgid&gt;
</span></span><span class="line"><span class="cl">ceph pg force-backfill &lt;pgid&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 PG 的 OSD</span>
</span></span><span class="line"><span class="cl">ceph pg ls-by-pool &lt;poolname&gt;
</span></span><span class="line"><span class="cl">ceph pg ls-by-primary &lt;osd-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># PG 自动修复</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> osd osd_scrub_auto_repair <span class="nb">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-7-认证管理">🔐 7. 认证管理</h2>
<h3 id="71-用户管理">7.1 用户管理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看认证信息</span>
</span></span><span class="line"><span class="cl">ceph auth list
</span></span><span class="line"><span class="cl">ceph auth get client.admin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建用户</span>
</span></span><span class="line"><span class="cl">ceph auth get-or-create client.&lt;name&gt; mon <span class="s1">&#39;allow r&#39;</span> osd <span class="s1">&#39;allow rw pool=&lt;poolname&gt;&#39;</span>
</span></span><span class="line"><span class="cl">ceph auth get-or-create client.rbd mon <span class="s1">&#39;profile rbd&#39;</span> osd <span class="s1">&#39;profile rbd pool=rbd&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除用户</span>
</span></span><span class="line"><span class="cl">ceph auth del client.&lt;name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导出/导入密钥</span>
</span></span><span class="line"><span class="cl">ceph auth <span class="nb">export</span> client.&lt;name&gt; &gt; client.&lt;name&gt;.keyring
</span></span><span class="line"><span class="cl">ceph auth import -i client.&lt;name&gt;.keyring
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="72-权限管理">7.2 权限管理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 修改用户权限</span>
</span></span><span class="line"><span class="cl">ceph auth caps client.&lt;name&gt; mon <span class="s1">&#39;allow r&#39;</span> osd <span class="s1">&#39;allow rw pool=rbd&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看权限</span>
</span></span><span class="line"><span class="cl">ceph auth get client.&lt;name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 生成客户端配置</span>
</span></span><span class="line"><span class="cl">ceph config generate-minimal-conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 常用权限模板</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 只读用户：mon &#39;allow r&#39; osd &#39;allow r&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># RBD用户：mon &#39;profile rbd&#39; osd &#39;profile rbd pool=rbd&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># CephFS用户：mon &#39;allow r&#39; mds &#39;allow rw&#39; osd &#39;allow rw pool=cephfs_data&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-8-crush-map-管理">🏗️ 8. CRUSH Map 管理</h2>
<h3 id="81-crush-基本操作">8.1 CRUSH 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 CRUSH map</span>
</span></span><span class="line"><span class="cl">ceph osd tree
</span></span><span class="line"><span class="cl">ceph osd crush tree
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导出/导入 CRUSH map</span>
</span></span><span class="line"><span class="cl">ceph osd getcrushmap -o crushmap.bin
</span></span><span class="line"><span class="cl">crushtool -d crushmap.bin -o crushmap.txt
</span></span><span class="line"><span class="cl">crushtool -c crushmap.txt -o crushmap-new.bin
</span></span><span class="line"><span class="cl">ceph osd setcrushmap -i crushmap-new.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建/删除 bucket</span>
</span></span><span class="line"><span class="cl">ceph osd crush add-bucket &lt;bucket-name&gt; &lt;bucket-type&gt;
</span></span><span class="line"><span class="cl">ceph osd crush remove &lt;bucket-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 移动 OSD 到不同位置</span>
</span></span><span class="line"><span class="cl">ceph osd crush move osd.X <span class="nv">host</span><span class="o">=</span>&lt;hostname&gt;
</span></span><span class="line"><span class="cl">ceph osd crush move osd.X <span class="nv">rack</span><span class="o">=</span>&lt;rackname&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="82-crush-规则管理">8.2 CRUSH 规则管理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 CRUSH 规则</span>
</span></span><span class="line"><span class="cl">ceph osd crush rule ls
</span></span><span class="line"><span class="cl">ceph osd crush rule dump
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 CRUSH 规则</span>
</span></span><span class="line"><span class="cl">ceph osd crush rule create-simple &lt;rule-name&gt; &lt;root&gt; &lt;type&gt;
</span></span><span class="line"><span class="cl">ceph osd crush rule create-replicated &lt;rule-name&gt; &lt;root&gt; &lt;failure-domain&gt; &lt;device-class&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除 CRUSH 规则</span>
</span></span><span class="line"><span class="cl">ceph osd crush rule rm &lt;rule-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 测试 CRUSH 映射</span>
</span></span><span class="line"><span class="cl">crushtool -i crushmap.bin --test --show-mappings --ruleset <span class="m">0</span> --num-rep <span class="m">3</span> --min-x <span class="m">0</span> --max-x <span class="m">100</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-9-rbd-管理">🎯 9. RBD 管理</h2>
<h3 id="91-rbd-基本操作">9.1 RBD 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 创建 RBD 镜像</span>
</span></span><span class="line"><span class="cl">rbd create --size <span class="m">1024</span> &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">rbd create --size 10G --image-feature layering,exclusive-lock mypool/myimage
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 RBD 镜像</span>
</span></span><span class="line"><span class="cl">rbd ls &lt;poolname&gt;
</span></span><span class="line"><span class="cl">rbd info &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">rbd du &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除 RBD 镜像</span>
</span></span><span class="line"><span class="cl">rbd rm &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">rbd trash mv &lt;poolname&gt;/&lt;image-name&gt;    <span class="c1"># 移动到回收站</span>
</span></span><span class="line"><span class="cl">rbd trash restore &lt;poolname&gt;/&lt;image-id&gt;  <span class="c1"># 从回收站恢复</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 调整镜像大小</span>
</span></span><span class="line"><span class="cl">rbd resize --size <span class="m">2048</span> &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">rbd resize --size 2G &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建快照</span>
</span></span><span class="line"><span class="cl">rbd snap create &lt;poolname&gt;/&lt;image-name&gt;@&lt;snap-name&gt;
</span></span><span class="line"><span class="cl">rbd snap ls &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">rbd snap rm &lt;poolname&gt;/&lt;image-name&gt;@&lt;snap-name&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="92-rbd-高级操作">9.2 RBD 高级操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 克隆镜像</span>
</span></span><span class="line"><span class="cl">rbd snap protect &lt;poolname&gt;/&lt;parent-image&gt;@&lt;snap-name&gt;
</span></span><span class="line"><span class="cl">rbd clone &lt;poolname&gt;/&lt;parent-image&gt;@&lt;snap-name&gt; &lt;poolname&gt;/&lt;child-image&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 展平克隆镜像</span>
</span></span><span class="line"><span class="cl">rbd flatten &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导出/导入镜像</span>
</span></span><span class="line"><span class="cl">rbd <span class="nb">export</span> &lt;poolname&gt;/&lt;image-name&gt; image.raw
</span></span><span class="line"><span class="cl">rbd <span class="nb">export</span> --export-format <span class="m">2</span> &lt;poolname&gt;/&lt;image-name&gt; image.raw
</span></span><span class="line"><span class="cl">rbd import image.raw &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 镜像映射</span>
</span></span><span class="line"><span class="cl">rbd map &lt;poolname&gt;/&lt;image-name&gt;
</span></span><span class="line"><span class="cl">rbd unmap /dev/rbdX
</span></span><span class="line"><span class="cl">rbd showmapped
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 镜像特性管理</span>
</span></span><span class="line"><span class="cl">rbd feature <span class="nb">enable</span> &lt;poolname&gt;/&lt;image-name&gt; exclusive-lock
</span></span><span class="line"><span class="cl">rbd feature disable &lt;poolname&gt;/&lt;image-name&gt; deep-flatten
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-10-cephfs-管理">🌐 10. CephFS 管理</h2>
<h3 id="101-cephfs-基本操作">10.1 CephFS 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 创建文件系统</span>
</span></span><span class="line"><span class="cl">ceph fs new &lt;fs-name&gt; &lt;metadata-pool&gt; &lt;data-pool&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看文件系统</span>
</span></span><span class="line"><span class="cl">ceph fs ls
</span></span><span class="line"><span class="cl">ceph fs status &lt;fs-name&gt;
</span></span><span class="line"><span class="cl">ceph fs get &lt;fs-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除文件系统</span>
</span></span><span class="line"><span class="cl">ceph fs fail &lt;fs-name&gt;
</span></span><span class="line"><span class="cl">ceph fs rm &lt;fs-name&gt; --yes-i-really-mean-it
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># MDS 管理</span>
</span></span><span class="line"><span class="cl">ceph mds stat
</span></span><span class="line"><span class="cl">ceph mds dump
</span></span><span class="line"><span class="cl">ceph mds fail &lt;mds-id&gt;
</span></span><span class="line"><span class="cl">ceph mds repaired &lt;mds-id&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="102-cephfs-客户端">10.2 CephFS 客户端</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 挂载 CephFS</span>
</span></span><span class="line"><span class="cl">mount -t ceph &lt;mon-addr&gt;:/ /mnt/cephfs -o <span class="nv">name</span><span class="o">=</span>admin,secret<span class="o">=</span>&lt;key&gt;
</span></span><span class="line"><span class="cl">mount -t ceph &lt;mon-addr&gt;:/ /mnt/cephfs -o <span class="nv">name</span><span class="o">=</span>admin,secretfile<span class="o">=</span>/etc/ceph/admin.secret
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 ceph-fuse</span>
</span></span><span class="line"><span class="cl">ceph-fuse /mnt/cephfs
</span></span><span class="line"><span class="cl">ceph-fuse /mnt/cephfs -o allow_other
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看客户端连接</span>
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; client ls
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; session ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 踢除客户端</span>
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; client evict <span class="nv">id</span><span class="o">=</span>&lt;client-id&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="103-cephfs-高级管理">10.3 CephFS 高级管理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 子目录挂载</span>
</span></span><span class="line"><span class="cl">mount -t ceph &lt;mon-addr&gt;:/subdir /mnt/subdir -o <span class="nv">name</span><span class="o">=</span>admin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 配置多个文件系统</span>
</span></span><span class="line"><span class="cl">ceph fs flag <span class="nb">set</span> enable_multiple <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 目录配额</span>
</span></span><span class="line"><span class="cl">setfattr -n ceph.quota.max_files -v <span class="m">10000</span> /mnt/cephfs/dir
</span></span><span class="line"><span class="cl">setfattr -n ceph.quota.max_bytes -v <span class="m">1000000000</span> /mnt/cephfs/dir
</span></span><span class="line"><span class="cl">getfattr -n ceph.quota.max_files /mnt/cephfs/dir
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-11-rgw-管理">☁️ 11. RGW 管理</h2>
<h3 id="111-rgw-基本操作">11.1 RGW 基本操作</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 创建用户</span>
</span></span><span class="line"><span class="cl">radosgw-admin user create --uid<span class="o">=</span>&lt;user-id&gt; --display-name<span class="o">=</span><span class="s2">&#34;&lt;display-name&gt;&#34;</span>
</span></span><span class="line"><span class="cl">radosgw-admin user create --uid<span class="o">=</span>testuser --display-name<span class="o">=</span><span class="s2">&#34;Test User&#34;</span> --email<span class="o">=</span>test@example.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看用户</span>
</span></span><span class="line"><span class="cl">radosgw-admin user list
</span></span><span class="line"><span class="cl">radosgw-admin user info --uid<span class="o">=</span>&lt;user-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除用户</span>
</span></span><span class="line"><span class="cl">radosgw-admin user rm --uid<span class="o">=</span>&lt;user-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修改用户</span>
</span></span><span class="line"><span class="cl">radosgw-admin user modify --uid<span class="o">=</span>&lt;user-id&gt; --display-name<span class="o">=</span><span class="s2">&#34;New Name&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建子用户</span>
</span></span><span class="line"><span class="cl">radosgw-admin subuser create --uid<span class="o">=</span>&lt;user-id&gt; --subuser<span class="o">=</span>&lt;subuser-id&gt; --access<span class="o">=</span>full
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="112-rgw-密钥管理">11.2 RGW 密钥管理</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 创建访问密钥</span>
</span></span><span class="line"><span class="cl">radosgw-admin key create --uid<span class="o">=</span>&lt;user-id&gt; --key-type<span class="o">=</span>s3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除访问密钥</span>
</span></span><span class="line"><span class="cl">radosgw-admin key rm --uid<span class="o">=</span>&lt;user-id&gt; --key-type<span class="o">=</span>s3 --access-key<span class="o">=</span>&lt;access-key&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 生成Swift密钥</span>
</span></span><span class="line"><span class="cl">radosgw-admin key create --uid<span class="o">=</span>&lt;user-id&gt; --key-type<span class="o">=</span>swift --gen-secret
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="113-rgw-维护">11.3 RGW 维护</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 检查 bucket 索引</span>
</span></span><span class="line"><span class="cl">radosgw-admin bucket check --bucket<span class="o">=</span>&lt;bucket-name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重建 bucket 索引</span>
</span></span><span class="line"><span class="cl">radosgw-admin bucket reshard --bucket<span class="o">=</span>&lt;bucket-name&gt; --num-shards<span class="o">=</span>&lt;num&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 垃圾回收</span>
</span></span><span class="line"><span class="cl">radosgw-admin gc list
</span></span><span class="line"><span class="cl">radosgw-admin gc process
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看使用统计</span>
</span></span><span class="line"><span class="cl">radosgw-admin usage show --uid<span class="o">=</span>&lt;user-id&gt;
</span></span><span class="line"><span class="cl">radosgw-admin usage show --show-log-entries<span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Bucket 管理</span>
</span></span><span class="line"><span class="cl">radosgw-admin bucket list
</span></span><span class="line"><span class="cl">radosgw-admin bucket stats --bucket<span class="o">=</span>&lt;bucket-name&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-12-配置管理">🔧 12. 配置管理</h2>
<h3 id="121-运行时配置">12.1 运行时配置</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看配置</span>
</span></span><span class="line"><span class="cl">ceph config dump
</span></span><span class="line"><span class="cl">ceph config get &lt;daemon-type&gt;.&lt;daemon-id&gt; &lt;option&gt;
</span></span><span class="line"><span class="cl">ceph config show &lt;daemon-type&gt;.&lt;daemon-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 设置配置</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> &lt;daemon-type&gt; &lt;option&gt; &lt;value&gt;
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> global osd_pool_default_size <span class="m">3</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> osd osd_max_backfills <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重置配置</span>
</span></span><span class="line"><span class="cl">ceph config rm &lt;daemon-type&gt; &lt;option&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看配置历史</span>
</span></span><span class="line"><span class="cl">ceph config log
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="122-临时配置调整">12.2 临时配置调整</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 临时设置配置（重启后失效）</span>
</span></span><span class="line"><span class="cl">ceph tell &lt;daemon-type&gt;.&lt;id&gt; config <span class="nb">set</span> &lt;option&gt; &lt;value&gt;
</span></span><span class="line"><span class="cl">ceph tell osd.* config <span class="nb">set</span> debug_osd <span class="m">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看配置</span>
</span></span><span class="line"><span class="cl">ceph tell &lt;daemon-type&gt;.&lt;id&gt; config show
</span></span><span class="line"><span class="cl">ceph tell &lt;daemon-type&gt;.&lt;id&gt; config get &lt;option&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 批量配置</span>
</span></span><span class="line"><span class="cl">ceph tell osd.* config <span class="nb">set</span> osd_max_backfills <span class="m">1</span>
</span></span><span class="line"><span class="cl">ceph tell mon.* config <span class="nb">set</span> debug_mon <span class="m">5</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-13-性能分析专项">📈 13. 性能分析专项</h2>
<h3 id="131-rbd-性能分析">13.1 RBD 性能分析</h3>
<h4 id="rbd-性能测试工具">RBD 性能测试工具</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 使用 rbd bench 进行性能测试</span>
</span></span><span class="line"><span class="cl">rbd bench --io-type write --io-size 4K --io-threads <span class="m">16</span> --io-total 1G &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">rbd bench --io-type <span class="nb">read</span> --io-size 4K --io-threads <span class="m">16</span> --io-total 1G &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">rbd bench --io-type readwrite --io-size 4K --io-threads <span class="m">16</span> --io-total 1G &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 fio 进行详细性能测试</span>
</span></span><span class="line"><span class="cl">fio --name<span class="o">=</span>rbd-test --ioengine<span class="o">=</span>rbd --pool<span class="o">=</span>&lt;pool&gt; --rbdname<span class="o">=</span>&lt;image&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --rw<span class="o">=</span>randwrite --bs<span class="o">=</span>4k --iodepth<span class="o">=</span><span class="m">32</span> --numjobs<span class="o">=</span><span class="m">4</span> --runtime<span class="o">=</span><span class="m">60</span> --group_reporting
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 测试不同块大小的性能</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> bs in 4k 8k 16k 32k 64k 128k<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Testing block size: </span><span class="nv">$bs</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    rbd bench --io-type write --io-size <span class="nv">$bs</span> --io-threads <span class="m">16</span> --io-total 512M &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 顺序读写测试</span>
</span></span><span class="line"><span class="cl">fio --name<span class="o">=</span>seq-write --ioengine<span class="o">=</span>rbd --pool<span class="o">=</span><span class="nb">test</span> --rbdname<span class="o">=</span>testimg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --rw<span class="o">=</span>write --bs<span class="o">=</span>1M --iodepth<span class="o">=</span><span class="m">1</span> --numjobs<span class="o">=</span><span class="m">1</span> --runtime<span class="o">=</span><span class="m">60</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="rbd-性能监控">RBD 性能监控</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 实时监控 RBD I/O</span>
</span></span><span class="line"><span class="cl">rbd perf image iostat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 RBD 镜像统计</span>
</span></span><span class="line"><span class="cl">rbd du &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">rbd info &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 监控客户端 I/O 模式</span>
</span></span><span class="line"><span class="cl">ceph daemon client.&lt;id&gt; perf dump
</span></span><span class="line"><span class="cl">ceph daemon client.&lt;id&gt; perf histogram dump
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 RBD 缓存统计</span>
</span></span><span class="line"><span class="cl">ceph daemon client.&lt;id&gt; config show <span class="p">|</span> grep rbd_cache
</span></span><span class="line"><span class="cl">ceph daemon client.&lt;id&gt; perf dump <span class="p">|</span> grep rbd_cache
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="rbd-性能调优参数">RBD 性能调优参数</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 客户端缓存优化</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_cache <span class="nb">true</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_cache_size <span class="m">134217728</span>           <span class="c1"># 128MB</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_cache_max_dirty <span class="m">100663296</span>      <span class="c1"># 96MB</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_cache_target_dirty <span class="m">67108864</span>    <span class="c1"># 64MB</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_cache_max_dirty_age 10.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 预读优化</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_readahead_trigger_requests <span class="m">10</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_readahead_max_bytes <span class="m">524288</span>     <span class="c1"># 512KB</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_readahead_disable_after_bytes <span class="m">52428800</span>  <span class="c1"># 50MB</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 并发优化</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_concurrent_management_ops <span class="m">20</span>
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> client rbd_op_threads <span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="132-cephfs-性能分析">13.2 CephFS 性能分析</h3>
<h4 id="cephfs-性能测试">CephFS 性能测试</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 使用 dd 进行基本性能测试</span>
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/mnt/cephfs/testfile <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">1000</span> <span class="nv">oflag</span><span class="o">=</span>direct
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>/mnt/cephfs/testfile <span class="nv">of</span><span class="o">=</span>/dev/null <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">iflag</span><span class="o">=</span>direct
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 iozone 进行全面性能测试</span>
</span></span><span class="line"><span class="cl">iozone -a -s 1G -r 4k -r 64k -r 1M -i <span class="m">0</span> -i <span class="m">1</span> -i <span class="m">2</span> -f /mnt/cephfs/testfile
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 小文件性能测试</span>
</span></span><span class="line"><span class="cl">mkdir /mnt/cephfs/small_files_test
</span></span><span class="line"><span class="cl"><span class="nb">time</span> <span class="k">for</span> i in <span class="o">{</span>1..10000<span class="o">}</span><span class="p">;</span> <span class="k">do</span> touch /mnt/cephfs/small_files_test/file_<span class="nv">$i</span><span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 元数据性能测试</span>
</span></span><span class="line"><span class="cl"><span class="nb">time</span> find /mnt/cephfs -name <span class="s2">&#34;*.txt&#34;</span> <span class="p">|</span> wc -l
</span></span><span class="line"><span class="cl"><span class="nb">time</span> ls -la /mnt/cephfs/large_directory/ <span class="p">|</span> wc -l
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 并发文件操作测试</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> i in <span class="o">{</span>1..10<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span><span class="k">for</span> j in <span class="o">{</span>1..1000<span class="o">}</span><span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">        touch /mnt/cephfs/test_<span class="si">${</span><span class="nv">i</span><span class="si">}</span>_<span class="si">${</span><span class="nv">j</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">done</span><span class="o">)</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl"><span class="nb">wait</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="cephfs-性能监控">CephFS 性能监控</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># MDS 性能统计</span>
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; perf dump
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; session ls
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; status
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; ops
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 客户端性能统计</span>
</span></span><span class="line"><span class="cl">ceph daemon client.&lt;id&gt; perf dump
</span></span><span class="line"><span class="cl">ceph daemon client.&lt;id&gt; client_metadata
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 MDS 负载</span>
</span></span><span class="line"><span class="cl">ceph fs status &lt;fsname&gt;
</span></span><span class="line"><span class="cl">ceph mds metadata &lt;mds-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 监控目录碎片化</span>
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; dirfrag ls &lt;path&gt;
</span></span><span class="line"><span class="cl">ceph daemon mds.&lt;id&gt; dirfrag split_info &lt;path&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="133-osd-性能分析">13.3 OSD 性能分析</h3>
<h4 id="osd-性能基准测试">OSD 性能基准测试</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># OSD 基准测试</span>
</span></span><span class="line"><span class="cl">ceph tell osd.&lt;id&gt; bench <span class="m">1073741824</span> <span class="m">4194304</span>              <span class="c1"># 1GB测试，4MB块大小</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 ceph-osd 直接测试</span>
</span></span><span class="line"><span class="cl">ceph-osd -i &lt;id&gt; --test-objectstore --test-objectstore-workload uniform_random
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 磁盘性能测试</span>
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/var/lib/ceph/osd/ceph-&lt;id&gt;/test <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">1000</span> <span class="nv">oflag</span><span class="o">=</span>direct
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>/var/lib/ceph/osd/ceph-&lt;id&gt;/test <span class="nv">of</span><span class="o">=</span>/dev/null <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">iflag</span><span class="o">=</span>direct
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 网络性能测试</span>
</span></span><span class="line"><span class="cl">iperf3 -s    <span class="c1"># 在目标OSD节点运行</span>
</span></span><span class="line"><span class="cl">iperf3 -c &lt;target-osd-ip&gt; -t <span class="m">30</span> -P <span class="m">4</span>    <span class="c1"># 在源节点运行</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 使用 rados bench 测试</span>
</span></span><span class="line"><span class="cl">rados bench -p &lt;pool&gt; <span class="m">60</span> write --no-cleanup
</span></span><span class="line"><span class="cl">rados bench -p &lt;pool&gt; <span class="m">60</span> seq
</span></span><span class="line"><span class="cl">rados bench -p &lt;pool&gt; <span class="m">60</span> rand
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; cleanup
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="osd-详细性能监控">OSD 详细性能监控</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># OSD 性能计数器</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; perf dump
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; perf histogram dump
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># OSD 操作统计</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_ops_in_flight
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_blocked_ops
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_op_pq_state
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># OSD 存储统计</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; status
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; df
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 慢操作分析</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_slow_requests
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_historic_slow_ops
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># OSD 恢复统计</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_recovery_reservations
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_backfill_reservations
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="134-整体集群性能分析">13.4 整体集群性能分析</h3>
<h4 id="集群级性能监控">集群级性能监控</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 集群 I/O 统计</span>
</span></span><span class="line"><span class="cl">ceph iostat
</span></span><span class="line"><span class="cl">watch <span class="s2">&#34;ceph iostat&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># PG 分布分析</span>
</span></span><span class="line"><span class="cl">ceph pg dump <span class="p">|</span> grep ^pg <span class="p">|</span> awk <span class="s1">&#39;{print $1,$15}&#39;</span> <span class="p">|</span> sort
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 实时性能监控脚本</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="k">$(</span>date<span class="k">)</span><span class="s2"> - IOPS: </span><span class="k">$(</span>ceph iostat <span class="p">|</span> grep -E <span class="s1">&#39;read|write&#39;</span><span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="k">$(</span>date<span class="k">)</span><span class="s2"> - Health: </span><span class="k">$(</span>ceph health<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    sleep <span class="m">5</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 集群延迟分析</span>
</span></span><span class="line"><span class="cl">ceph osd perf <span class="p">|</span> grep -E <span class="s2">&#34;apply_latency|commit_latency&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-14-ceph-专用工具集">🛠️ 14. Ceph 专用工具集</h2>
<h3 id="141-数据恢复和诊断工具">14.1 数据恢复和诊断工具</h3>
<h4 id="ceph-objectstore-tool-对象存储工具">ceph-objectstore-tool (对象存储工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 列出对象存储内容</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-&lt;id&gt; --op list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导出 PG 数据</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-&lt;id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --op <span class="nb">export</span> --pgid &lt;pg-id&gt; --file /tmp/pg_export.dat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导入 PG 数据</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-&lt;id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --op import --file /tmp/pg_export.dat
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除损坏的对象</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-&lt;id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --op remove --pgid &lt;pg-id&gt; --oid &lt;object-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修复对象存储</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-&lt;id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --op fsck --debug
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看对象信息</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-&lt;id&gt; <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --op info --pgid &lt;pg-id&gt; --oid &lt;object-id&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ceph-kvstore-tool-键值存储工具">ceph-kvstore-tool (键值存储工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 列出键值对</span>
</span></span><span class="line"><span class="cl">ceph-kvstore-tool bluestore-kv /var/lib/ceph/osd/ceph-&lt;id&gt; list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 获取特定键值</span>
</span></span><span class="line"><span class="cl">ceph-kvstore-tool bluestore-kv /var/lib/ceph/osd/ceph-&lt;id&gt; get &lt;prefix&gt; &lt;key&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 删除键值对</span>
</span></span><span class="line"><span class="cl">ceph-kvstore-tool bluestore-kv /var/lib/ceph/osd/ceph-&lt;id&gt; rm &lt;prefix&gt; &lt;key&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 压缩数据库</span>
</span></span><span class="line"><span class="cl">ceph-kvstore-tool bluestore-kv /var/lib/ceph/osd/ceph-&lt;id&gt; compact
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 备份/恢复键值存储</span>
</span></span><span class="line"><span class="cl">ceph-kvstore-tool bluestore-kv /var/lib/ceph/osd/ceph-&lt;id&gt; backup /tmp/kv_backup
</span></span><span class="line"><span class="cl">ceph-kvstore-tool bluestore-kv /var/lib/ceph/osd/ceph-&lt;id&gt; restore /tmp/kv_backup
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 统计信息</span>
</span></span><span class="line"><span class="cl">ceph-kvstore-tool bluestore-kv /var/lib/ceph/osd/ceph-&lt;id&gt; stats
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ceph-bluestore-tool-bluestore-专用工具">ceph-bluestore-tool (BlueStore 专用工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看 BlueStore 信息</span>
</span></span><span class="line"><span class="cl">ceph-bluestore-tool show-label --dev /dev/sdX
</span></span><span class="line"><span class="cl">ceph-bluestore-tool prime-osd-dir --dev /dev/sdX --path /var/lib/ceph/osd/ceph-X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 修复 BlueStore</span>
</span></span><span class="line"><span class="cl">ceph-bluestore-tool fsck --path /var/lib/ceph/osd/ceph-&lt;id&gt;
</span></span><span class="line"><span class="cl">ceph-bluestore-tool repair --path /var/lib/ceph/osd/ceph-&lt;id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 展示 BlueStore 元数据</span>
</span></span><span class="line"><span class="cl">ceph-bluestore-tool show-label --dev /dev/sdX
</span></span><span class="line"><span class="cl">ceph-bluestore-tool show-label --path /var/lib/ceph/osd/ceph-&lt;id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 蓝存储空间分析</span>
</span></span><span class="line"><span class="cl">ceph-bluestore-tool bluefs-stats --path /var/lib/ceph/osd/ceph-&lt;id&gt;
</span></span><span class="line"><span class="cl">ceph-bluestore-tool bluefs-bdev-sizes --path /var/lib/ceph/osd/ceph-&lt;id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 分配器工具</span>
</span></span><span class="line"><span class="cl">ceph-bluestore-tool free-dump --path /var/lib/ceph/osd/ceph-&lt;id&gt;
</span></span><span class="line"><span class="cl">ceph-bluestore-tool free-score --path /var/lib/ceph/osd/ceph-&lt;id&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="142-监控和管理工具">14.2 监控和管理工具</h3>
<h4 id="crushtool-crush-映射工具">crushtool (CRUSH 映射工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 编译/反编译 CRUSH map</span>
</span></span><span class="line"><span class="cl">ceph osd getcrushmap -o crushmap.bin
</span></span><span class="line"><span class="cl">crushtool -d crushmap.bin -o crushmap.txt
</span></span><span class="line"><span class="cl">crushtool -c crushmap.txt -o crushmap_new.bin
</span></span><span class="line"><span class="cl">ceph osd setcrushmap -i crushmap_new.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 测试 CRUSH 规则</span>
</span></span><span class="line"><span class="cl">crushtool -i crushmap.bin --test --show-mappings --ruleset <span class="m">0</span> --num-rep <span class="m">3</span> --min-x <span class="m">0</span> --max-x <span class="m">100</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 分析 CRUSH 权重</span>
</span></span><span class="line"><span class="cl">crushtool -i crushmap.bin --show-choose-tries
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 验证 CRUSH map</span>
</span></span><span class="line"><span class="cl">crushtool -i crushmap.bin --check
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 显示 CRUSH 树结构</span>
</span></span><span class="line"><span class="cl">crushtool -i crushmap.bin --tree
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="monmaptool-monitor-映射工具">monmaptool (Monitor 映射工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 创建 Monitor map</span>
</span></span><span class="line"><span class="cl">monmaptool --create --add &lt;mon-id&gt; &lt;mon-addr&gt; --fsid &lt;uuid&gt; monmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 Monitor map</span>
</span></span><span class="line"><span class="cl">monmaptool --print monmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 添加/删除 Monitor</span>
</span></span><span class="line"><span class="cl">monmaptool --add &lt;mon-id&gt; &lt;mon-addr&gt; monmap.bin
</span></span><span class="line"><span class="cl">monmaptool --rm &lt;mon-id&gt; monmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 生成新的 fsid</span>
</span></span><span class="line"><span class="cl">uuidgen
</span></span><span class="line"><span class="cl">monmaptool --create --fsid <span class="k">$(</span>uuidgen<span class="k">)</span> monmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 从现有集群提取</span>
</span></span><span class="line"><span class="cl">ceph mon getmap -o monmap.bin
</span></span><span class="line"><span class="cl">monmaptool --print monmap.bin
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="osdmaptool-osd-映射工具">osdmaptool (OSD 映射工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 导出 OSD map</span>
</span></span><span class="line"><span class="cl">ceph osd getmap -o osdmap.bin
</span></span><span class="line"><span class="cl">osdmaptool osdmap.bin --print
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 测试 PG 映射</span>
</span></span><span class="line"><span class="cl">osdmaptool osdmap.bin --test-map-pgs --pool &lt;pool-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建增量 map</span>
</span></span><span class="line"><span class="cl">osdmaptool --createsimple <span class="m">3</span> osdmap.bin --with-default-pool
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导出特定 epoch 的 map</span>
</span></span><span class="line"><span class="cl">ceph osd getmap &lt;epoch&gt; -o osdmap_&lt;epoch&gt;.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 显示 OSD 树</span>
</span></span><span class="line"><span class="cl">osdmaptool osdmap.bin --tree
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="143-数据迁移和同步工具">14.3 数据迁移和同步工具</h3>
<h4 id="rados-对象存储客户端">rados (对象存储客户端)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 基本对象操作</span>
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; put &lt;object&gt; &lt;file&gt;
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; get &lt;object&gt; &lt;file&gt;
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; ls
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; rm &lt;object&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 批量操作</span>
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; ls <span class="p">|</span> xargs -I <span class="o">{}</span> rados -p &lt;pool&gt; rm <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 基准测试</span>
</span></span><span class="line"><span class="cl">rados bench -p &lt;pool&gt; <span class="m">60</span> write --no-cleanup
</span></span><span class="line"><span class="cl">rados bench -p &lt;pool&gt; <span class="m">60</span> seq
</span></span><span class="line"><span class="cl">rados bench -p &lt;pool&gt; <span class="m">60</span> rand
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 清理基准测试数据</span>
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; cleanup
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 对象属性操作</span>
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; setxattr &lt;object&gt; &lt;attr&gt; &lt;value&gt;
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; getxattr &lt;object&gt; &lt;attr&gt;
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; listxattr &lt;object&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 监视对象变化</span>
</span></span><span class="line"><span class="cl">rados -p &lt;pool&gt; watch &lt;object&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="rbd-mirror-rbd-镜像工具">rbd-mirror (RBD 镜像工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 启用镜像</span>
</span></span><span class="line"><span class="cl">rbd mirror pool <span class="nb">enable</span> &lt;pool&gt; pool
</span></span><span class="line"><span class="cl">rbd mirror pool <span class="nb">enable</span> &lt;pool&gt; image
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 配置镜像</span>
</span></span><span class="line"><span class="cl">rbd mirror image <span class="nb">enable</span> &lt;pool&gt;/&lt;image&gt; snapshot
</span></span><span class="line"><span class="cl">rbd mirror image <span class="nb">enable</span> &lt;pool&gt;/&lt;image&gt; journal
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看镜像状态</span>
</span></span><span class="line"><span class="cl">rbd mirror pool status &lt;pool&gt;
</span></span><span class="line"><span class="cl">rbd mirror image status &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 强制重新同步</span>
</span></span><span class="line"><span class="cl">rbd mirror image resync &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 故障转移</span>
</span></span><span class="line"><span class="cl">rbd mirror image promote &lt;pool&gt;/&lt;image&gt;
</span></span><span class="line"><span class="cl">rbd mirror image demote &lt;pool&gt;/&lt;image&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ceph-crash-崩溃报告工具">ceph-crash (崩溃报告工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看崩溃报告</span>
</span></span><span class="line"><span class="cl">ceph crash ls
</span></span><span class="line"><span class="cl">ceph crash info &lt;crash-id&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 归档崩溃报告</span>
</span></span><span class="line"><span class="cl">ceph crash archive &lt;crash-id&gt;
</span></span><span class="line"><span class="cl">ceph crash archive-all
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 生成崩溃报告</span>
</span></span><span class="line"><span class="cl">ceph crash post -i &lt;crash-dump-file&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 统计崩溃报告</span>
</span></span><span class="line"><span class="cl">ceph crash stat
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ceph-volume-卷管理工具">ceph-volume (卷管理工具)</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># LVM 方式创建 OSD</span>
</span></span><span class="line"><span class="cl">ceph-volume lvm create --data /dev/sdb
</span></span><span class="line"><span class="cl">ceph-volume lvm create --data /dev/sdb --block.wal /dev/nvme0n1p1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 准备和激活分离</span>
</span></span><span class="line"><span class="cl">ceph-volume lvm prepare --data /dev/sdb --osd-id <span class="m">0</span>
</span></span><span class="line"><span class="cl">ceph-volume lvm activate <span class="m">0</span> &lt;osd-uuid&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看 LVM 信息</span>
</span></span><span class="line"><span class="cl">ceph-volume lvm list
</span></span><span class="line"><span class="cl">ceph-volume lvm list /dev/sdb
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 简单方式创建 OSD</span>
</span></span><span class="line"><span class="cl">ceph-volume simple scan /dev/sdb
</span></span><span class="line"><span class="cl">ceph-volume simple activate &lt;osd-id&gt; &lt;osd-uuid&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-15-故障排查">🚨 15. 故障排查</h2>
<h3 id="151-日志查看">15.1 日志查看</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 查看各服务日志</span>
</span></span><span class="line"><span class="cl">journalctl -u ceph-mon@&lt;hostname&gt; -f
</span></span><span class="line"><span class="cl">journalctl -u ceph-osd@&lt;id&gt; -f
</span></span><span class="line"><span class="cl">journalctl -u ceph-mds@&lt;hostname&gt; -f
</span></span><span class="line"><span class="cl">journalctl -u ceph-mgr@&lt;hostname&gt; -f
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 按时间范围查看日志</span>
</span></span><span class="line"><span class="cl">journalctl -u ceph-osd@&lt;id&gt; --since <span class="s2">&#34;2023-01-01 00:00:00&#34;</span> --until <span class="s2">&#34;2023-01-01 23:59:59&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 调整日志级别</span>
</span></span><span class="line"><span class="cl">ceph tell osd.* config <span class="nb">set</span> debug_osd <span class="m">10</span>
</span></span><span class="line"><span class="cl">ceph tell mon.* config <span class="nb">set</span> debug_mon <span class="m">10</span>
</span></span><span class="line"><span class="cl">ceph tell mds.* config <span class="nb">set</span> debug_mds <span class="m">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 查看实时错误</span>
</span></span><span class="line"><span class="cl">tail -f /var/log/ceph/ceph.log <span class="p">|</span> grep -i error
</span></span><span class="line"><span class="cl">tail -f /var/log/ceph/ceph-osd.*.log <span class="p">|</span> grep -i slow
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="152-常见问题排查">15.2 常见问题排查</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># PG 不一致问题</span>
</span></span><span class="line"><span class="cl">ceph health detail <span class="p">|</span> grep inconsistent
</span></span><span class="line"><span class="cl">ceph pg &lt;pgid&gt; query
</span></span><span class="line"><span class="cl">ceph pg repair &lt;pgid&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># OSD 满载问题</span>
</span></span><span class="line"><span class="cl">ceph osd df <span class="p">|</span> grep -E <span class="s2">&#34;(95|96|97|98|99)%&#34;</span>
</span></span><span class="line"><span class="cl">ceph osd reweight-by-utilization
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 慢请求问题</span>
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_slow_requests
</span></span><span class="line"><span class="cl">ceph daemon osd.&lt;id&gt; dump_historic_slow_ops
</span></span><span class="line"><span class="cl">ceph config <span class="nb">set</span> osd debug_osd <span class="m">10</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 时钟同步问题</span>
</span></span><span class="line"><span class="cl">ceph time-sync-status
</span></span><span class="line"><span class="cl">ntpq -p
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 磁盘空间问题</span>
</span></span><span class="line"><span class="cl">ceph df
</span></span><span class="line"><span class="cl">ceph osd df
</span></span><span class="line"><span class="cl">df -h /var/lib/ceph/osd/
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="-16-备份恢复">🔄 16. 备份恢复</h2>
<h3 id="161-数据备份">16.1 数据备份</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 导出 Monitor map</span>
</span></span><span class="line"><span class="cl">ceph mon getmap -o monmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导出 OSD map</span>
</span></span><span class="line"><span class="cl">ceph osd getmap -o osdmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 导出 CRUSH map</span>
</span></span><span class="line"><span class="cl">ceph osd getcrushmap -o crushmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 备份 ceph.conf 和密钥</span>
</span></span><span class="line"><span class="cl">cp /etc/ceph/ceph.conf /backup/
</span></span><span class="line"><span class="cl">cp /etc/ceph/ceph.client.admin.keyring /backup/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 备份认证信息</span>
</span></span><span class="line"><span class="cl">ceph auth <span class="nb">export</span> &gt; /backup/ceph_auth.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 备份存储池信息</span>
</span></span><span class="line"><span class="cl">ceph osd pool ls detail &gt; /backup/pools.txt
</span></span><span class="line"><span class="cl">ceph pg dump &gt; /backup/pg_dump.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="162-灾难恢复">16.2 灾难恢复</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 从单个 OSD 恢复数据</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-X <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --export-remove --pgid &lt;pgid&gt; --file /tmp/pg_export
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 重建 Monitor</span>
</span></span><span class="line"><span class="cl">ceph-mon --mkfs -i &lt;mon-id&gt; --monmap monmap.bin --keyring mon.keyring
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 恢复认证信息</span>
</span></span><span class="line"><span class="cl">ceph auth import -i /backup/ceph_auth.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 恢复 CRUSH map</span>
</span></span><span class="line"><span class="cl">ceph osd setcrushmap -i /backup/crushmap.bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># OSD 数据恢复</span>
</span></span><span class="line"><span class="cl">ceph-objectstore-tool --data-path /var/lib/ceph/osd/ceph-X <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --op import --file /tmp/pg_export
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="163-rbd-备份恢复">16.3 RBD 备份恢复</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># RBD 快照备份</span>
</span></span><span class="line"><span class="cl">rbd snap create &lt;pool&gt;/&lt;image&gt;@backup-<span class="k">$(</span>date +%Y%m%d<span class="k">)</span>
</span></span><span class="line"><span class="cl">rbd <span class="nb">export</span> &lt;pool&gt;/&lt;image&gt;@&lt;snapshot&gt; /backup/image_backup.raw
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RBD 增量备份</span>
</span></span><span class="line"><span class="cl">rbd export-diff &lt;pool&gt;/&lt;image&gt;@&lt;snap1&gt; &lt;pool&gt;/&lt;image&gt;@&lt;snap2&gt; /backup/diff.raw
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RBD 恢复</span>
</span></span><span class="line"><span class="cl">rbd import /backup/image_backup.raw &lt;pool&gt;/&lt;new-image&gt;
</span></span><span class="line"><span class="cl">rbd import-diff /backup/diff.raw &lt;pool&gt;/&lt;image&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>本文档持续更新，建议定期检查最新版本。如有任何问题或建议，欢迎反馈。</strong></p>
<p><em>最后更新时间：2025年06月</em></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">YLShi && WuHongSong</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        0001-01-01
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/ceph-content/operation-skills/zh-cn/ceph%E9%9B%86%E7%BE%A4%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default"></span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
            repo="YLShiJustFly/YLShiJustFly.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:youseeicanfly@126.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.zhihu.com/people/tan-xi-liu-nian" class="iconfont icon-zhihu" title="zhihu"></a>
  <a href="http://YLShiJustFly.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2022 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span>YLShi && WuHongSong</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.191509a5c8442abdb6eb5020a332fd59bdd83a7e78a2d2241108df9113504292.js"></script>








</body>
</html>
